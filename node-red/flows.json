[{"id":"8ac4bc30b42b7a7d","type":"tab","label":"Maison - Notifications","disabled":false,"info":"","env":[]},{"id":"b094d7f93a062c25","type":"tab","label":"Scheduler - Agenda - Presence","disabled":false,"info":"","env":[]},{"id":"63ef5fda.dd974","type":"tab","label":"Lumière","disabled":false,"info":"","env":[]},{"id":"7a831b6e2f802ee7","type":"tab","label":"Chauffage","disabled":false,"info":"","env":[]},{"id":"2751f6a3a0a7649a","type":"tab","label":"Alarme","disabled":false,"info":"","env":[]},{"id":"96aba16699ebe8be","type":"tab","label":"Ballon Eau Chaude","disabled":false,"info":"","env":[]},{"id":"335bd89f27c73b7e","type":"tab","label":"Communications - Alexa - SMS - Telegram","disabled":false,"info":"","env":[]},{"id":"d9ababc8eca2aa56","type":"tab","label":"Portails et volets","disabled":false,"info":"","env":[]},{"id":"c375fce693136161","type":"tab","label":"Météo","disabled":false,"info":"","env":[]},{"id":"d7f40c000c1a05ef","type":"tab","label":"Informatique","disabled":false,"info":"","env":[]},{"id":"b6bf4fb2.8e8618","type":"tab","label":"Téléinfo","disabled":false,"info":""},{"id":"b7a3c194e014f96d","type":"tab","label":"Prises Electrique","disabled":false,"info":"","env":[]},{"id":"bd8aec8f1871271e","type":"tab","label":"Portier && Tablette","disabled":false,"info":"","env":[]},{"id":"cb6f6212810a81c8","type":"tab","label":"Test","disabled":false,"info":"","env":[]},{"id":"7512dcc2.be07d4","type":"mqtt-broker","name":"mosquitto","broker":"192.168.0.243","port":"1883","clientid":"NodeRed","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"29cc3035.d7f7","type":"serial-port","serialport":"/dev/ttyUSB0","serialbaud":"1200","databits":"7","parity":"even","stopbits":"1","waitfor":"","newline":"0x3","bin":"false","out":"char","addchar":"","responsetimeout":"10000"},{"id":"a5f60f435cd422f8","type":"light-scheduler-settings","name":"MaMaison","latitude":"48.856614","longitude":"2.3522219"},{"id":"43d85569dace75e0","type":"server","name":"HomeAssistant","version":2,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":false,"cacheJson":true,"heartbeat":true,"heartbeatInterval":"30"},{"id":"5837179e.526928","type":"websocket-client","path":"ws://supervisor/core/api/websocket","tls":"","wholemsg":"false"},{"id":"da25d8286baff521","type":"serial-port","serialport":"/dev/ttyUSB0","serialbaud":"1200","databits":"7","parity":"even","stopbits":"1","waitfor":"","newline":"0x3","bin":"false","out":"char","addchar":"","responsetimeout":"10000"},{"id":"580338f6.25a79","type":"mqtt-broker","name":"mosquitto","broker":"192.168.0.90","port":"1883","clientid":"NodeRed","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"8d3225795fd44357","type":"comment","z":"8ac4bc30b42b7a7d","name":"Coupure électrique","info":"","x":90,"y":60,"wires":[]},{"id":"7fe9986ac3be1269","type":"comment","z":"8ac4bc30b42b7a7d","name":"Ouverture fermeture portail garage","info":"","x":140,"y":420,"wires":[]},{"id":"34f4f67a6f773e62","type":"comment","z":"8ac4bc30b42b7a7d","name":"Boite aux lettres -  Colis","info":"","x":100,"y":740,"wires":[]},{"id":"d0076350c0f37b23","type":"comment","z":"8ac4bc30b42b7a7d","name":"Boite aux lettres -  Lettres","info":"","x":110,"y":960,"wires":[]},{"id":"db0416aa8ab8ec35","type":"switch","z":"8ac4bc30b42b7a7d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":840,"wires":[["94362ad1bff9a6ea","bf524822f4db734d","559ffc9b1cc28961"]]},{"id":"df3c1473a368154d","type":"and-gate","z":"8ac4bc30b42b7a7d","name":"","rules":[{"t":"eq","v":"off","vt":"str","propertyType":"msg","property":"payload","topic":"binary_sensor.co_boite_aux_lettres_lettres"},{"t":"eq","v":"on","vt":"str","propertyType":"msg","property":"payload","topic":"binary_sensor.co_boite_aux_lettres_colis_is_open"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":true,"x":500,"y":1060,"wires":[["953bb15e45cf2ab9"]]},{"id":"94362ad1bff9a6ea","type":"function","z":"8ac4bc30b42b7a7d","name":"Notification - Colis","func":"msg.payload =\n\n\"Un colis à été déposé dans la boite aux lettres\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":840,"wires":[["96be6e4d60ae3a6e","c9477649ee561bab"]]},{"id":"96be6e4d60ae3a6e","type":"link out","z":"8ac4bc30b42b7a7d","name":"VersEchos","mode":"link","links":["22186f7a74fec36f","34dd5813f28f2a42","57aaf9213ca5863b","93d062bbf9af5c89","a7ddbf0dfd2c325b"],"x":990,"y":840,"wires":[],"l":true},{"id":"393b8d98a4c7669c","type":"function","z":"8ac4bc30b42b7a7d","name":"Notification - Colis","func":"msg.payload =\n\n\"Du courrier à été déposé dans la boite aux lettres\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1150,"y":1060,"wires":[["c0aba76949d071e3"]]},{"id":"c0aba76949d071e3","type":"link out","z":"8ac4bc30b42b7a7d","name":"VersEchos","mode":"link","links":["22186f7a74fec36f","34dd5813f28f2a42","57aaf9213ca5863b","93d062bbf9af5c89","a7ddbf0dfd2c325b"],"x":1370,"y":1060,"wires":[],"l":true},{"id":"953bb15e45cf2ab9","type":"api-render-template","z":"8ac4bc30b42b7a7d","name":"Prevention notif vent","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('weather.maison', 'wind_speed')|float <= 25 }}\n{{false if state_attr('weather.maison', 'wind_speed')|float > 25 }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":720,"y":1060,"wires":[["cc566b0def2813b7","7dd1e87165907cbf"]]},{"id":"cc566b0def2813b7","type":"switch","z":"8ac4bc30b42b7a7d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":930,"y":1060,"wires":[["393b8d98a4c7669c","bf524822f4db734d","559ffc9b1cc28961","1c49bf2c96a525a0"]]},{"id":"7dd1e87165907cbf","type":"debug","z":"8ac4bc30b42b7a7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":980,"wires":[]},{"id":"bf524822f4db734d","type":"link out","z":"8ac4bc30b42b7a7d","name":"Demande de photo Portier","mode":"link","links":["231b1b91f3733db4"],"x":1140,"y":920,"wires":[],"l":true},{"id":"10d29581f2317061","type":"inject","z":"8ac4bc30b42b7a7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":440,"y":1300,"wires":[["d2d97b4b170e80ed"]]},{"id":"c3182103944e887a","type":"cron","z":"8ac4bc30b42b7a7d","name":"At 14 PM","crontab":"0 14 * * *","x":120,"y":1360,"wires":[["469fe2413452d5b5"]]},{"id":"a60c2f4da2710433","type":"switch","z":"8ac4bc30b42b7a7d","name":"","property":"isBatteryLow","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":1360,"wires":[["d2d97b4b170e80ed"]]},{"id":"6610eacdb60d442a","type":"link out","z":"8ac4bc30b42b7a7d","name":"","mode":"link","links":[],"x":905,"y":1340,"wires":[]},{"id":"873c0deb3c42b25b","type":"comment","z":"8ac4bc30b42b7a7d","name":"Notification de niveau de batterie","info":"","x":420,"y":1260,"wires":[]},{"id":"d2d97b4b170e80ed","type":"api-render-template","z":"8ac4bc30b42b7a7d","name":"Liste des détecteurs","server":"43d85569dace75e0","version":0,"template":"    {% set result = namespace(sensors=[]) %}\n    {% set ns = namespace(found = 'Attention niveau batterie !! sur: ') %}\n    {% set exclude = [] %}\n    {% set threshold = 20 %}\n    {% for state in states.sensor | selectattr('attributes.device_class', '==', 'battery') %}\n      {% if 0 < state.state | int < threshold | int and not state.entity_id in exclude %}\n        {% set result.sensors = result.sensors + [state.name] %}\n      {% endif %}\n    {% endfor %}\n    {% for state in states.binary_sensor | selectattr('attributes.device_class', '==', 'battery') | selectattr('state', '==', 'on') %}\n      {% if not state.entity_id in exclude %}\n        {% set result.sensors = result.sensors + [state.name] %}\n      {% endif %}\n    {% endfor %}\n    {{ns.found + result.sensors|join(',  ')}}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":660,"y":1340,"wires":[["6610eacdb60d442a"]]},{"id":"469fe2413452d5b5","type":"api-render-template","z":"8ac4bc30b42b7a7d","name":"isBatteryLow","server":"43d85569dace75e0","version":0,"template":"  {% set ns = namespace(found = false) %}\n    {% set exclude = [] %}\n    {% set threshold = 20 %}\n    {% for state in states.sensor | selectattr('attributes.device_class', '==', 'battery') %}\n      {% if 0 < state.state | int < threshold | int and not state.entity_id in exclude %}\n        {% set ns.found = true %}\n      {% endif %}\n    {% endfor %}\n    {% for state in states.binary_sensor | selectattr('attributes.device_class', '==', 'battery') | selectattr('state', '==', 'on') %}\n      {% if not state.entity_id in exclude %}\n        {% set ns.found = true %}\n      {% endif %}\n    {% endfor %}\n    {{ ns.found }}","resultsLocation":"isBatteryLow","resultsLocationType":"msg","templateLocation":"templateIsBatteryLow","templateLocationType":"msg","x":290,"y":1360,"wires":[["a60c2f4da2710433"]]},{"id":"d9e7d96d715b9843","type":"inject","z":"8ac4bc30b42b7a7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1260,"wires":[["469fe2413452d5b5"]]},{"id":"559ffc9b1cc28961","type":"link out","z":"8ac4bc30b42b7a7d","name":"VersDoorbirdVersHAFrontend","mode":"link","links":["d24025ec168c1be2"],"x":1150,"y":980,"wires":[],"l":true},{"id":"cd65961ec4a18883","type":"debug","z":"8ac4bc30b42b7a7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":740,"wires":[]},{"id":"5da9360b2fea6718","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"Boites aux lettres - Colis","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.co_boite_aux_lettres_colis_is_open","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":840,"wires":[["db0416aa8ab8ec35","cd65961ec4a18883"]]},{"id":"4f6eabc35390803c","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"Boites aux lettres - Colis","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.co_boite_aux_lettres_colis_is_open","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":1100,"wires":[["0fdbec29c7c3a6ac","c0b0053dcbe323a6"]]},{"id":"cfbcbc19733fecea","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"Boites aux lettres - Lettres","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.co_boite_aux_lettres_lettres","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":1040,"wires":[["0fdbec29c7c3a6ac","c0b0053dcbe323a6"]]},{"id":"0fdbec29c7c3a6ac","type":"debug","z":"8ac4bc30b42b7a7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":400,"y":980,"wires":[]},{"id":"41f18396597fde91","type":"inject","z":"8ac4bc30b42b7a7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":880,"y":1140,"wires":[["393b8d98a4c7669c"]]},{"id":"c9477649ee561bab","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"Alert visuelle Colis","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.boite_aux_lettres_colis"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":760,"wires":[["b969504b41d24578"]]},{"id":"1c49bf2c96a525a0","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"Alert visuelle lettre","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.boite_aux_lettres_lettre"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":1120,"wires":[[]]},{"id":"8c1ee6a1bfc5cd3f","type":"cron","z":"8ac4bc30b42b7a7d","name":"At 1:15 AM","crontab":"0 0 * * *","x":1480,"y":860,"wires":[["dbbb5bf59b9275e4","4dff2732e1b24bcf"]]},{"id":"dbbb5bf59b9275e4","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"Alert visuelle Colis","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.boite_aux_lettres_colis"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1690,"y":840,"wires":[[]]},{"id":"4dff2732e1b24bcf","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"Alert visuelle lettre","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.boite_aux_lettres_lettre"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1690,"y":880,"wires":[[]]},{"id":"c0b0053dcbe323a6","type":"delay","z":"8ac4bc30b42b7a7d","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":360,"y":1060,"wires":[["df3c1473a368154d"]]},{"id":"b969504b41d24578","type":"delay","z":"8ac4bc30b42b7a7d","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1200,"y":760,"wires":[["c9351cdb312383b5"]]},{"id":"c9351cdb312383b5","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"Alert visuelle lettre","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.boite_aux_lettres_lettre"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1370,"y":760,"wires":[[]]},{"id":"05eb498563ed7908","type":"inject","z":"8ac4bc30b42b7a7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":700,"wires":[["c9477649ee561bab"]]},{"id":"85196be3391ca02f","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"vacuum.valetudo_aspirateur_rdc","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":1560,"wires":[["9b8e43143918de4f","b24dc13007b233ed"]]},{"id":"a66959d6120beb1c","type":"comment","z":"8ac4bc30b42b7a7d","name":"Aspirateur Salon","info":"","x":100,"y":1480,"wires":[]},{"id":"b51c72fabf8cc164","type":"link out","z":"8ac4bc30b42b7a7d","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["57aaf9213ca5863b","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":1360,"y":1560,"wires":[],"l":true},{"id":"f64337526a77711c","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"vacuum.valetudo_aspirateur_etage","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":350,"y":1680,"wires":[["b24dc13007b233ed"]]},{"id":"0337e97108151a9c","type":"comment","z":"8ac4bc30b42b7a7d","name":"Aspirateur Etage","info":"","x":100,"y":1620,"wires":[]},{"id":"947352445fca1bbc","type":"comment","z":"8ac4bc30b42b7a7d","name":"Arosage","info":"","x":60,"y":1900,"wires":[]},{"id":"21bf813d4695a67a","type":"cron","z":"8ac4bc30b42b7a7d","name":"At 23:00 PM","crontab":"00 23 * * *","x":390,"y":1960,"wires":[["aea0ec75bdf892f6"]]},{"id":"aea0ec75bdf892f6","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.arrosage"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":1960,"wires":[[]]},{"id":"401970048c245b75","type":"cron","z":"8ac4bc30b42b7a7d","name":"At 23:15 PM","crontab":"15 23 * * *","x":390,"y":2040,"wires":[["c39afa77802be191"]]},{"id":"c39afa77802be191","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":["048609826a85397fbaac683c9e137d67"],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":2040,"wires":[[]]},{"id":"a9bff8bfea40ccaa","type":"function","z":"8ac4bc30b42b7a7d","name":"Notification - Arrosage","func":"function addZero(i) {\n  if (i < 10) {\n    i = \"0\" + i;\n  }\n  return i;\n}\n\nvar d = new Date();\nvar h = addZero(d.getHours());\nvar m = addZero(d.getMinutes());\n\n\n\n\n\nmsg.payload =\n\n\"Mise en marche de l'arrosage à :\"+ h + \":\" + m ;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":2100,"wires":[["96f5d3f606ab6e18"]]},{"id":"96f5d3f606ab6e18","type":"link out","z":"8ac4bc30b42b7a7d","name":"Nofification","mode":"link","links":["93d062bbf9af5c89","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":1250,"y":2140,"wires":[],"l":true},{"id":"065ee5138f70d848","type":"function","z":"8ac4bc30b42b7a7d","name":"Notification - Arrosage","func":"function addZero(i) {\n  if (i < 10) {\n    i = \"0\" + i;\n  }\n  return i;\n}\n\nvar d = new Date();\nvar h = addZero(d.getHours());\nvar m = addZero(d.getMinutes());\n\n\n\n\n\nmsg.payload =\n\n\"Arrêt de l'arrosage à :\"+ h + \":\" + m ;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":2180,"wires":[["96f5d3f606ab6e18"]]},{"id":"6d1b622b3437dd05","type":"link out","z":"8ac4bc30b42b7a7d","name":"VersEchos","mode":"link","links":["34dd5813f28f2a42","a7ddbf0dfd2c325b","ced87f2e5d5c0601"],"x":1050,"y":480,"wires":[],"l":true},{"id":"f712e511f4a13f37","type":"function","z":"8ac4bc30b42b7a7d","name":"Notification - Ouverture du portail garage","func":"\nmsg.payload =\"Le portail du garage est ouvert !\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":440,"wires":[["6d1b622b3437dd05"]]},{"id":"47ad7d59a045a7e3","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"Information état portail garage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.co_portail_garage_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"30","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":380,"y":480,"wires":[["f712e511f4a13f37"],["d4e095d67b0ba915"]]},{"id":"ef3c5dbe17d68bb6","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"Arrêt arrosage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.arrosage","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":450,"y":2240,"wires":[["2a2918eb5773878e"]]},{"id":"2a2918eb5773878e","type":"switch","z":"8ac4bc30b42b7a7d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":2240,"wires":[["b7ade3f2d3e6ac8b"]]},{"id":"b7ade3f2d3e6ac8b","type":"delay","z":"8ac4bc30b42b7a7d","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":790,"y":2240,"wires":[["9ab0d9532eb15bc1"]]},{"id":"9ab0d9532eb15bc1","type":"api-call-service","z":"8ac4bc30b42b7a7d","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":["048609826a85397fbaac683c9e137d67"],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1000,"y":2240,"wires":[[]]},{"id":"01cd02de2285bf80","type":"inject","z":"8ac4bc30b42b7a7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":800,"y":1860,"wires":[["a9bff8bfea40ccaa"]]},{"id":"8a934b079040a07f","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"Arrêt arrosage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.arrosage","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":450,"y":2140,"wires":[["64d9c547522dcc4f"]]},{"id":"64d9c547522dcc4f","type":"switch","z":"8ac4bc30b42b7a7d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":2140,"wires":[["a9bff8bfea40ccaa"],["065ee5138f70d848"]]},{"id":"d4e095d67b0ba915","type":"function","z":"8ac4bc30b42b7a7d","name":"Notification - Fermeture du portail garage","func":"\nmsg.payload =\"Le portail garage est fermé !\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":520,"wires":[["6d1b622b3437dd05"]]},{"id":"b24dc13007b233ed","type":"function","z":"8ac4bc30b42b7a7d","name":"Aspirateur Etage","func":"var name = msg.data.new_state.attributes.friendly_name\nvar statut = msg.payload\nif(statut== \"cleaning\")\n{\n    statut = \"En cours de nettoyage\"\n}\nif(statut== \"idle\")\n{\n    statut = \"Inatif\"\n}\nif(statut== \"returning\")\n{\n    statut = \"retour à la base d'accueil\"\n}\nif(statut== \"paused\")\n{\n    statut = \"En pause\"\n}\nif(statut== \"docked\")\n{\n    statut = \"En charge\"\n}\nif(statut== \"unavailable\")\n{\n    statut = \"Indisponible\"\n}\n\n\n\nmsg.payload = \"Nouvel évenement de l'\" + name +  \" .Son nouveau statut: \"+ statut\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1030,"y":1560,"wires":[["b51c72fabf8cc164"]]},{"id":"9b8e43143918de4f","type":"debug","z":"8ac4bc30b42b7a7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1480,"wires":[]},{"id":"5ad06d7022050774","type":"function","z":"8ac4bc30b42b7a7d","name":"","func":"var meteoCouleur = msg.data.new_state.state;\n\nif(meteoCouleur == \"Jaune\")\n{\n    textMeteoColor = \" SOYEZ ATTENTIF. Si vous pratiquez des activités sensibles au risque météorologique ou exposées aux crues\"\n}\n\nif(meteoCouleur == \"Orange\")\n{\n    textMeteoColor = \" SOYEZ TRES VIGILANT. Des phénomènes dangereux sont prévus.\"\n}\n\nif(meteoCouleur == \"Rouge\")\n{\n    textMeteoColor = \" UNE VILANCE ANSOLUE S'IMPOSE. Des phénomènes dangereux d'intensité exceptionnelle sont prévus.\"\n}\n\n\n\n\nmsg.payload = msg.payloadDescription + \".   \" + textMeteoColor\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":1380,"wires":[[]]},{"id":"e363f0acfe619bb8","type":"server-state-changed","z":"8ac4bc30b42b7a7d","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.myups_battery_charge","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":230,"y":200,"wires":[[]]},{"id":"915ff36906e4efe3","type":"function","z":"8ac4bc30b42b7a7d","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":200,"wires":[[]]},{"id":"23b76999371f37b9","type":"light-scheduler","z":"b094d7f93a062c25","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":1,\"mod\":960},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":975},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":955},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":960},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":955},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":960},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":955},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Calendrier_nuit","name":"Début de nuit","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":"-3","sunShowElevationInStatus":true,"outputfreq":"output.statechange.startup","x":150,"y":220,"wires":[["ece2555b7528c6fb"]]},{"id":"ece2555b7528c6fb","type":"link out","z":"b094d7f93a062c25","name":"Calendrier nuit","mode":"link","links":["c7ca5c039d5c7a21"],"x":340,"y":220,"wires":[],"l":true},{"id":"91f954152b71a7b0","type":"light-scheduler","z":"b094d7f93a062c25","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":1,\"mod\":1320},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":1320},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":1320},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":1320},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":1320},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":1320},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":1320},\"end\":{\"dow\":1,\"mod\":0}},{\"start\":{\"dow\":1,\"mod\":0},\"end\":{\"dow\":1,\"mod\":450}},{\"start\":{\"dow\":2,\"mod\":0},\"end\":{\"dow\":2,\"mod\":450}},{\"start\":{\"dow\":3,\"mod\":0},\"end\":{\"dow\":3,\"mod\":450}},{\"start\":{\"dow\":4,\"mod\":0},\"end\":{\"dow\":4,\"mod\":450}},{\"start\":{\"dow\":5,\"mod\":0},\"end\":{\"dow\":5,\"mod\":450}},{\"start\":{\"dow\":6,\"mod\":0},\"end\":{\"dow\":6,\"mod\":480}},{\"start\":{\"dow\":0,\"mod\":0},\"end\":{\"dow\":0,\"mod\":480}}]","topic":"pascalCalendrier","name":"Nuit","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":false,"scheduleRndMax":"5","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":210,"y":440,"wires":[["8f037705b88d191b"]]},{"id":"481254c3f7bee86a","type":"comment","z":"b094d7f93a062c25","name":"Utilisation pour le chauffage","info":"","x":120,"y":380,"wires":[]},{"id":"8f037705b88d191b","type":"link out","z":"b094d7f93a062c25","name":"Planification nuit - chauffage","mode":"link","links":["29fbdb3bdfc73afe","36cf861f20879d52","5f84210c843e6c77","ade3db62a58d1519","c01800f3bbf64032"],"x":305,"y":440,"wires":[]},{"id":"fdb3864040309458","type":"light-scheduler","z":"b094d7f93a062c25","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":6,\"mod\":510},\"end\":{\"dow\":6,\"mod\":600}},{\"start\":{\"dow\":1,\"mod\":375},\"end\":{\"dow\":1,\"mod\":480}},{\"start\":{\"dow\":2,\"mod\":375},\"end\":{\"dow\":2,\"mod\":480}},{\"start\":{\"dow\":3,\"mod\":375},\"end\":{\"dow\":3,\"mod\":480}},{\"start\":{\"dow\":4,\"mod\":375},\"end\":{\"dow\":4,\"mod\":480}},{\"start\":{\"dow\":5,\"mod\":375},\"end\":{\"dow\":5,\"mod\":480}},{\"start\":{\"dow\":0,\"mod\":510},\"end\":{\"dow\":0,\"mod\":600}},{\"start\":{\"dow\":1,\"mod\":1065},\"end\":{\"dow\":1,\"mod\":1200}},{\"start\":{\"dow\":2,\"mod\":1065},\"end\":{\"dow\":2,\"mod\":1200}},{\"start\":{\"dow\":3,\"mod\":1065},\"end\":{\"dow\":3,\"mod\":1200}},{\"start\":{\"dow\":4,\"mod\":1065},\"end\":{\"dow\":4,\"mod\":1200}},{\"start\":{\"dow\":5,\"mod\":1065},\"end\":{\"dow\":5,\"mod\":1200}},{\"start\":{\"dow\":6,\"mod\":1020},\"end\":{\"dow\":6,\"mod\":1200}},{\"start\":{\"dow\":0,\"mod\":1020},\"end\":{\"dow\":0,\"mod\":1200}}]","topic":"CalendrierSDB","name":"CalendrierSDB","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":false,"scheduleRndMax":"5","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":180,"y":520,"wires":[["56d5d7f26c66f602"]]},{"id":"56d5d7f26c66f602","type":"link out","z":"b094d7f93a062c25","name":"Planification SDB - chauffage","mode":"link","links":["574ea8a16e0e5e40"],"x":305,"y":520,"wires":[]},{"id":"175f8a036ff287f8","type":"light-scheduler","z":"b094d7f93a062c25","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":0,\"mod\":450},\"end\":{\"dow\":0,\"mod\":630}},{\"start\":{\"dow\":1,\"mod\":1110},\"end\":{\"dow\":1,\"mod\":1235}},{\"start\":{\"dow\":2,\"mod\":1110},\"end\":{\"dow\":2,\"mod\":1235}},{\"start\":{\"dow\":3,\"mod\":1110},\"end\":{\"dow\":3,\"mod\":1235}},{\"start\":{\"dow\":4,\"mod\":1110},\"end\":{\"dow\":4,\"mod\":1235}},{\"start\":{\"dow\":5,\"mod\":1110},\"end\":{\"dow\":5,\"mod\":1235}},{\"start\":{\"dow\":6,\"mod\":450},\"end\":{\"dow\":6,\"mod\":630}},{\"start\":{\"dow\":6,\"mod\":720},\"end\":{\"dow\":6,\"mod\":810}},{\"start\":{\"dow\":0,\"mod\":720},\"end\":{\"dow\":0,\"mod\":810}},{\"start\":{\"dow\":0,\"mod\":1110},\"end\":{\"dow\":0,\"mod\":1230}},{\"start\":{\"dow\":6,\"mod\":1110},\"end\":{\"dow\":6,\"mod\":1235}}]","topic":"calendrierCuisine","name":"Chauffage - Cuisine","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":false,"scheduleRndMax":"5","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":170,"y":600,"wires":[["4d1f3537c1b54fee"]]},{"id":"4d1f3537c1b54fee","type":"link out","z":"b094d7f93a062c25","name":"Planification Cuisine - chauffage","mode":"link","links":["1790e4cb6e09093c"],"x":305,"y":600,"wires":[]},{"id":"bd8970503b3f3a7f","type":"light-scheduler","z":"b094d7f93a062c25","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":3,\"mod\":450},\"end\":{\"dow\":3,\"mod\":870}},{\"start\":{\"dow\":4,\"mod\":450},\"end\":{\"dow\":4,\"mod\":870}},{\"start\":{\"dow\":5,\"mod\":450},\"end\":{\"dow\":5,\"mod\":870}},{\"start\":{\"dow\":6,\"mod\":600},\"end\":{\"dow\":6,\"mod\":750}},{\"start\":{\"dow\":0,\"mod\":600},\"end\":{\"dow\":0,\"mod\":750}},{\"start\":{\"dow\":2,\"mod\":450},\"end\":{\"dow\":2,\"mod\":870}},{\"start\":{\"dow\":1,\"mod\":450},\"end\":{\"dow\":1,\"mod\":870}},{\"start\":{\"dow\":1,\"mod\":960},\"end\":{\"dow\":1,\"mod\":1080}},{\"start\":{\"dow\":2,\"mod\":960},\"end\":{\"dow\":2,\"mod\":1080}},{\"start\":{\"dow\":3,\"mod\":960},\"end\":{\"dow\":3,\"mod\":1080}},{\"start\":{\"dow\":4,\"mod\":960},\"end\":{\"dow\":4,\"mod\":1080}},{\"start\":{\"dow\":5,\"mod\":960},\"end\":{\"dow\":5,\"mod\":1080}}]","topic":"calendrierBuanderie","name":"Agenda - Buanderie","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":false,"scheduleRndMax":"15","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":160,"y":700,"wires":[["315fa278c4352517"]]},{"id":"315fa278c4352517","type":"link out","z":"b094d7f93a062c25","name":"Planification Buanderie - chauffage","mode":"link","links":["0d0c5ad07af9abee"],"x":305,"y":700,"wires":[]},{"id":"d8edf5eff79aded3","type":"light-scheduler","z":"b094d7f93a062c25","settings":"","events":"[]","topic":"","name":"","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":140,"y":880,"wires":[[]]},{"id":"55c063734e6192d8","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_clarence","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":780,"y":680,"wires":[["d6c00c5eebea2eba"]]},{"id":"d6c00c5eebea2eba","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1070,"y":680,"wires":[["51c5d76e07062d13"],["ed10b17b5c714452"],["2591fb93b672e8f9"]]},{"id":"dcb2cfc6121a09f6","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_pascal","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":900,"wires":[["f9af9b3cfd0a9798"]]},{"id":"f9af9b3cfd0a9798","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1050,"y":900,"wires":[["ac6c83359e19d1fe"],["4103a3c550a12d16"],["28e7c41f7843eb8a"]]},{"id":"31fc7c5bb5a010a5","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["57aaf9213ca5863b","93d062bbf9af5c89"],"x":1615,"y":920,"wires":[]},{"id":"e60ecf28612d47f5","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["343866db0d57e779","d1dc7f1a2fa6359d"],"x":1655,"y":640,"wires":[]},{"id":"74d76ef4b2a822ba","type":"function","z":"b094d7f93a062c25","name":"Agenda Clarence","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\nmsg.payload +\n\"{{(states.calendar.agenda_clarence.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1490,"y":660,"wires":[["e60ecf28612d47f5"]]},{"id":"3824900ed1039e6c","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_eloise","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":1160,"wires":[["f706c471eab134c4"]]},{"id":"f706c471eab134c4","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1050,"y":1160,"wires":[["19d0707214e72393"],["109e2387934009a3"],["5c0c8e60ab1a2127"]]},{"id":"659a6c074b508660","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["88f4a6b9887ab019","e8df3e37b83f6011"],"x":1755,"y":1160,"wires":[]},{"id":"5640e436dd95198d","type":"function","z":"b094d7f93a062c25","name":"Agenda Eloise","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\nmsg.payload+\n\"{{(states.calendar.agenda_eloise.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1540,"y":1160,"wires":[["659a6c074b508660"]]},{"id":"af57abcef8bd8267","type":"comment","z":"b094d7f93a062c25","name":"Rappel Agenda","info":"","x":580,"y":620,"wires":[]},{"id":"3177e6aad35503a8","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_famille","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":1020,"wires":[["5168ea14a74716fa"]]},{"id":"5168ea14a74716fa","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1050,"y":1020,"wires":[["3ed9be10b45e195f"],["c6c33471ac1a482f"],["1da6b7868ffafe8d"]]},{"id":"9d42168c56cd5db2","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["34dd5813f28f2a42","9017154cf2b33cbe","ced87f2e5d5c0601"],"x":1755,"y":1040,"wires":[]},{"id":"ca634ed6055312ec","type":"function","z":"b094d7f93a062c25","name":"Agenda Nous","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\nmsg.payload +\n\"{{(states.calendar.agenda_famille.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1520,"y":1040,"wires":[["9d42168c56cd5db2"]]},{"id":"43a1a39d42c5b4d2","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_stephanie","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":760,"y":780,"wires":[["efe7048f1a66b611"]]},{"id":"efe7048f1a66b611","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1050,"y":780,"wires":[["a21c05e95e48f0a6"],["ba3edc69450fe8be"],["379a8fcb943baaef"]]},{"id":"a557a7b86a26bd4f","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["22186f7a74fec36f","34dd5813f28f2a42"],"x":1655,"y":780,"wires":[]},{"id":"93ed12aab4bf1d1b","type":"function","z":"b094d7f93a062c25","name":"Agenda Stéphanie","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\nmsg.payload+\n\"{{(states.calendar.agenda_stephanie.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1490,"y":780,"wires":[["a557a7b86a26bd4f"]]},{"id":"1c62c89a4a6c25f8","type":"function","z":"b094d7f93a062c25","name":"Agenda Pascal","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\nmsg.payload+\n\"{{(states.calendar.agenda_pascal.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1480,"y":920,"wires":[["31fc7c5bb5a010a5"]]},{"id":"ac6c83359e19d1fe","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"aujourd'hui à {{ strptime(states.calendar.agenda_pascal.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1230,"y":880,"wires":[["1c62c89a4a6c25f8"]]},{"id":"4103a3c550a12d16","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_pascal.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1220,"y":920,"wires":[["1c62c89a4a6c25f8"]]},{"id":"28e7c41f7843eb8a","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_pascal.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1240,"y":960,"wires":[["1c62c89a4a6c25f8"]]},{"id":"a21c05e95e48f0a6","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"aujourd'hui à {{ strptime(states.calendar.agenda_stephanie.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1230,"y":740,"wires":[["93ed12aab4bf1d1b"]]},{"id":"ba3edc69450fe8be","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_stephanie.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1220,"y":780,"wires":[["93ed12aab4bf1d1b"]]},{"id":"379a8fcb943baaef","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_stephanie.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1240,"y":820,"wires":[["93ed12aab4bf1d1b"]]},{"id":"3ed9be10b45e195f","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"aujourd'hui à {{ strptime(states.calendar.agenda_famille.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1230,"y":1020,"wires":[["ca634ed6055312ec"]]},{"id":"c6c33471ac1a482f","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_famille.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1220,"y":1060,"wires":[["ca634ed6055312ec"]]},{"id":"1da6b7868ffafe8d","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_famille.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1240,"y":1100,"wires":[["ca634ed6055312ec"]]},{"id":"19d0707214e72393","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"aujourd'hui à {{ strptime(states.calendar.agenda_eloise.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1230,"y":1160,"wires":[["5640e436dd95198d"]]},{"id":"109e2387934009a3","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_eloise.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1220,"y":1200,"wires":[["5640e436dd95198d"]]},{"id":"5c0c8e60ab1a2127","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_eloise.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1240,"y":1240,"wires":[["5640e436dd95198d"]]},{"id":"51c5d76e07062d13","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"aujourd'hui à {{ strptime(states.calendar.agenda_clarence.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1230,"y":620,"wires":[["74d76ef4b2a822ba"]]},{"id":"ed10b17b5c714452","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_clarence.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1220,"y":660,"wires":[["74d76ef4b2a822ba"]]},{"id":"2591fb93b672e8f9","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_clarence.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1240,"y":700,"wires":[["74d76ef4b2a822ba"]]},{"id":"ee3b76b9870128f8","type":"inject","z":"b094d7f93a062c25","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":820,"y":1280,"wires":[["853691fec1ebec59"]]},{"id":"795537c787e3ad00","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_pascal_pro","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":790,"y":1400,"wires":[["ad882d31cd350b1a"]]},{"id":"ad882d31cd350b1a","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1070,"y":1400,"wires":[["853691fec1ebec59"],["708dc58670279751"],["c5a5ee47f811e7b4"]]},{"id":"dea7cdc98f11bbce","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["57aaf9213ca5863b","93d062bbf9af5c89"],"x":1635,"y":1380,"wires":[]},{"id":"527345f9a3679479","type":"function","z":"b094d7f93a062c25","name":"Agenda Pascal pro","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\n\nmsg.payload +\n\"{{(states.calendar.agenda_pascal_pro.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1510,"y":1380,"wires":[["dea7cdc98f11bbce"]]},{"id":"853691fec1ebec59","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"Ajourd'hui à {{ strptime(states.calendar.agenda_pascal_pro.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1250,"y":1340,"wires":[["527345f9a3679479"]]},{"id":"708dc58670279751","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_pascal_pro.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1240,"y":1400,"wires":[["527345f9a3679479"]]},{"id":"c5a5ee47f811e7b4","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_pascal_pro.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1260,"y":1460,"wires":[["527345f9a3679479"]]},{"id":"5bbf859dc54a76ac","type":"inject","z":"b094d7f93a062c25","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1040,"y":1100,"wires":[["19d0707214e72393"]]},{"id":"5ab5832ad4443f0d","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_jour_ferie","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":740,"y":1620,"wires":[["5bb168b8939c3637"]]},{"id":"5bb168b8939c3637","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1090,"y":1640,"wires":[["8c864f393c255218"],["ecdd7f2e9303d4bf"],["52febba3538f323d"]]},{"id":"f08afd7a73f4a1c1","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["9017154cf2b33cbe"],"x":1705,"y":1640,"wires":[]},{"id":"52a8b6cd3c539939","type":"function","z":"b094d7f93a062c25","name":"Agenda jour férié","func":"msg.payload =\n\nmsg.payload +\n\" est un jour férié ou une fête: \"+\n\n\"{{(states.calendar.agenda_jours_feries_en_france.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1550,"y":1640,"wires":[["f08afd7a73f4a1c1"]]},{"id":"ecdd7f2e9303d4bf","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Mémo agenda - Demain c'est :","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1280,"y":1620,"wires":[["52a8b6cd3c539939"]]},{"id":"52febba3538f323d","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"Mémo agenda - Dans 2 jours c'est","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1300,"y":1680,"wires":[["52a8b6cd3c539939"]]},{"id":"11baebeadf276eb4","type":"inject","z":"b094d7f93a062c25","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1020,"y":1540,"wires":[["ecdd7f2e9303d4bf"]]},{"id":"07e83d3a0b9932a0","type":"server-state-changed","z":"b094d7f93a062c25","name":"isPascalHome","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.portable_pascal","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":440,"wires":[["bad489de84f4a868","89248fce253cc1f1"]]},{"id":"b076cd7a5c8c2a9e","type":"server-state-changed","z":"b094d7f93a062c25","name":"isEloiseHome","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.eloise_telephone","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":360,"wires":[["1ee2a23c251bedc6","89248fce253cc1f1"]]},{"id":"38cbc093c45eea66","type":"server-state-changed","z":"b094d7f93a062c25","name":"isStephanieHome","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.stephanie_telephone","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":770,"y":280,"wires":[["4bfd02bf4bccc494","89248fce253cc1f1"]]},{"id":"77760b5ae2252400","type":"server-state-changed","z":"b094d7f93a062c25","name":"isClarenceHome","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.clarence_telephone","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":760,"y":200,"wires":[["4a76006d167611ed","89248fce253cc1f1"]]},{"id":"4a76006d167611ed","type":"link out","z":"b094d7f93a062c25","name":"isClarenceHome","mode":"link","links":["375b82636d7a79f6","3cd247daf365b2fd","66c859b82b0636b2"],"x":945,"y":200,"wires":[]},{"id":"4bfd02bf4bccc494","type":"link out","z":"b094d7f93a062c25","name":"isStephanieHome ","mode":"link","links":["2f4dc3a9426aea21","8778ffab08b483a2","a816ec7a5ecd3f3b","e1c4159e31696650"],"x":945,"y":280,"wires":[]},{"id":"1ee2a23c251bedc6","type":"link out","z":"b094d7f93a062c25","name":"isEloiseHome ","mode":"link","links":["49592774c4355c50","777c856f808f5fbf","b220c4e8614dfea9","f40ed06bb045a5c0","dfc25bb15d82d95d"],"x":945,"y":360,"wires":[]},{"id":"bad489de84f4a868","type":"link out","z":"b094d7f93a062c25","name":"isPascalHome ","mode":"link","links":["20a0a4870c67c998","26d54a9eca6b04cd","44e74b55c4bdd613","9ab68b836c7baf13","d6d92f7d48d98949","dfc25bb15d82d95d","f40ed06bb045a5c0"],"x":945,"y":440,"wires":[]},{"id":"89248fce253cc1f1","type":"or-gate","z":"b094d7f93a062c25","name":"isFamillyHome","rules":[{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.portable_pascal"},{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.eloise_telephone"},{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.clarence_telephone"},{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.stephanie_telephone"}],"outputTopic":"orGate","gateType":"or","emitOnlyIfTrue":false,"x":1000,"y":120,"wires":[["7cc76cb3055d7e49"]]},{"id":"7cc76cb3055d7e49","type":"link out","z":"b094d7f93a062c25","name":"isFamillyHome","mode":"link","links":["206ca0e256606cfd","37a0ccd1bbcc12e8","19a0a665f63b1f3b","687bfcd629c1339a","871aea2b3fcafe83","a64ccc3d67ad8a44","caeb02f4ca4a2319","c954e55b86f8d076"],"x":1175,"y":120,"wires":[]},{"id":"8c864f393c255218","type":"api-render-template","z":"b094d7f93a062c25","name":"Ajourd'hui","server":"43d85569dace75e0","version":0,"template":"Mémo agenda - Aujourd'hui c'est :","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1280,"y":1560,"wires":[["52a8b6cd3c539939"]]},{"id":"a9e2dd98e9acbc61","type":"server-state-changed","z":"b094d7f93a062c25","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.rappel_agenda_parents","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":740,"y":1820,"wires":[["d3d4e6775aba60cc"]]},{"id":"d3d4e6775aba60cc","type":"switch","z":"b094d7f93a062c25","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"120","vt":"str"},{"t":"eq","v":"1440","vt":"str"},{"t":"eq","v":"2880","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1030,"y":1820,"wires":[["c226bfc96d322796"],["5830e7072c071675"],["a954c26c5ed9ebac"]]},{"id":"b13a88254386f9ea","type":"link out","z":"b094d7f93a062c25","name":"","mode":"link","links":["34dd5813f28f2a42","57aaf9213ca5863b","ced87f2e5d5c0601","d3a1124a6206c675"],"x":1735,"y":1820,"wires":[]},{"id":"50b30e0b8f230256","type":"function","z":"b094d7f93a062c25","name":"Agenda Parents","func":"msg.payload =\n\n\"Rappel d'un évenement de votre agenda! \"+\nmsg.payload+\n\"{{(states.calendar.agenda_parents.attributes.message)}} \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1520,"y":1820,"wires":[["b13a88254386f9ea"]]},{"id":"c226bfc96d322796","type":"api-render-template","z":"b094d7f93a062c25","name":"Aujourd'hui","server":"43d85569dace75e0","version":0,"template":"aujourd'hui à {{ strptime(states.calendar.agenda_parents.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1210,"y":1820,"wires":[["50b30e0b8f230256"]]},{"id":"5830e7072c071675","type":"api-render-template","z":"b094d7f93a062c25","name":"Demain","server":"43d85569dace75e0","version":0,"template":"Demain à {{ strptime(states.calendar.agenda_parents.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"%H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1200,"y":1860,"wires":[["50b30e0b8f230256"]]},{"id":"a954c26c5ed9ebac","type":"api-render-template","z":"b094d7f93a062c25","name":"Après demain","server":"43d85569dace75e0","version":0,"template":"{{ strptime(states.calendar.agenda_parents.attributes.start_time, \"%Y-%m-%d %H:%M:%S\").strftime( \"le %d %m à %H heures %M\") }}\"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1220,"y":1900,"wires":[["50b30e0b8f230256"]]},{"id":"70d088d6d888c0c6","type":"inject","z":"b094d7f93a062c25","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":800,"y":1940,"wires":[[]]},{"id":"60b0c1e1b1a10a1a","type":"light-scheduler","z":"b094d7f93a062c25","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":1,\"mod\":960},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":975},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":955},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":960},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":955},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":960},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":955},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Calendrier_nuit","name":"Début de nuit","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":true,"scheduleRndMax":"2","sunElevationThreshold":"-3","sunShowElevationInStatus":true,"outputfreq":"output.statechange.startup","x":210,"y":140,"wires":[["c56f0ce32fa9429c"]]},{"id":"7c6830aa8a855fd3","type":"link out","z":"b094d7f93a062c25","name":"Calendrier - Every minutes","mode":"link","links":["72b05815a19e251e","b75d6df5c3d3d33c","ec201e1ae0ea9190"],"x":660,"y":120,"wires":[],"l":true},{"id":"191df863763f60b9","type":"server-state-changed","z":"b094d7f93a062c25","name":"isNuit ?","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.nuit","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":80,"wires":[["c56f0ce32fa9429c"]]},{"id":"c56f0ce32fa9429c","type":"or-gate","z":"b094d7f93a062c25","name":"","rules":[{"t":"true","propertyType":"msg","property":"payload","topic":"Calendrier_nuit"},{"t":"eq","v":"on","vt":"str","propertyType":"msg","property":"payload","topic":"binary_sensor.nuit"}],"outputTopic":"orGate","gateType":"or","emitOnlyIfTrue":false,"x":440,"y":120,"wires":[["7c6830aa8a855fd3"]]},{"id":"3cc77e8f498a61f2","type":"server-state-changed","z":"63ef5fda.dd974","name":"IR Garage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.ir_garage_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":220,"y":240,"wires":[["7de4720955b4f73b"],[]]},{"id":"b6a6cdf2e837a57c","type":"comment","z":"63ef5fda.dd974","name":"Lumière garage","info":"","x":80,"y":60,"wires":[]},{"id":"0447dd138dc2f62b","type":"api-call-service","z":"63ef5fda.dd974","name":"Lumière garage ON","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.multilevel_power_switch_instance_1_level"],"data":"{\"brightness_pct\":100}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":690,"y":280,"wires":[["b640a4ca5505633c"]]},{"id":"545b82574f071d40","type":"comment","z":"63ef5fda.dd974","name":"Télécommande - Eclairage salon lecture","info":"","x":160,"y":800,"wires":[]},{"id":"9e75743d3b936f4c","type":"server-state-changed","z":"63ef5fda.dd974","name":"Télécommande - Eclairage salon","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.telecommande_ampoule_salon_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":410,"y":680,"wires":[["f8d9e4f74c1e198c","2257313d46ada8fd"]]},{"id":"f8d9e4f74c1e198c","type":"switch","z":"63ef5fda.dd974","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":720,"y":680,"wires":[["b4752f9256ad0b6a"],["fc062bfec72a7e1e"],["aaf0d97ca420adda"],["9df81c3525300c5c"]]},{"id":"2257313d46ada8fd","type":"debug","z":"63ef5fda.dd974","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":680,"y":620,"wires":[]},{"id":"b4752f9256ad0b6a","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1020,"y":600,"wires":[[]]},{"id":"fc062bfec72a7e1e","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":660,"wires":[[]]},{"id":"aaf0d97ca420adda","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité +","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon"],"data":"{\"brightness_step_pct\":10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":700,"wires":[[]]},{"id":"9df81c3525300c5c","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité -","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon"],"data":"{\"brightness_step_pct\":-10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":740,"wires":[[]]},{"id":"de416c43a96d6d5e","type":"switch","z":"63ef5fda.dd974","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":710,"y":900,"wires":[["8c8c8acfb1b37f75"],["7cd8e5fc27bb650a"],["44986fbac8887aba"],["4375414e369b9434"]]},{"id":"7099fa3e601c06b5","type":"server-state-changed","z":"63ef5fda.dd974","name":"Télécommande - Eclairage salon lecture","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.telecommande_lumiere_ampoule_salon_lecture_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":420,"y":900,"wires":[["de416c43a96d6d5e"]]},{"id":"b9ebaed8073a0973","type":"comment","z":"63ef5fda.dd974","name":"Télécommande - Eclairage salon","info":"","x":130,"y":580,"wires":[]},{"id":"8c8c8acfb1b37f75","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon_lecture"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":840,"wires":[[]]},{"id":"7cd8e5fc27bb650a","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon_lecture"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1000,"y":900,"wires":[[]]},{"id":"44986fbac8887aba","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité +","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon_lecture"],"data":"{\"brightness_step_pct\":10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":980,"y":940,"wires":[[]]},{"id":"4375414e369b9434","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité -","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon_lecture"],"data":"{\"brightness_step_pct\":-10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":980,"y":980,"wires":[[]]},{"id":"c5790fe2a3dbbd1e","type":"comment","z":"63ef5fda.dd974","name":"Télécommande - Eclairage chambre parents","info":"","x":170,"y":1100,"wires":[]},{"id":"80d9b525f995326c","type":"switch","z":"63ef5fda.dd974","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":470,"y":1200,"wires":[["9cd5a447888bff96"],["1d41ba2ff024b7a5"],["571e033dd1e27cbb"],["a0e11075ef2b3aa1"]]},{"id":"f10743ec0d8cb815","type":"server-state-changed","z":"63ef5fda.dd974","name":"Télécommande - Eclairage chambre parents","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.telecommande_chambre_parents_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":1200,"wires":[["80d9b525f995326c"]]},{"id":"9cd5a447888bff96","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.lumiere_chambre_parents"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":1120,"wires":[[]]},{"id":"1d41ba2ff024b7a5","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.lumiere_chambre_parents"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":1200,"wires":[[]]},{"id":"571e033dd1e27cbb","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité +","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_parents_1","light.ampoule_chambre_parents_2"],"data":"{\"brightness_step_pct\":10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":650,"y":1260,"wires":[[]]},{"id":"a0e11075ef2b3aa1","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité -","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_parents_1","light.ampoule_chambre_parents_2"],"data":"{\"brightness_step_pct\":-10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":650,"y":1320,"wires":[[]]},{"id":"31c0c3c77564037b","type":"comment","z":"63ef5fda.dd974","name":"Télécommande - Eclairage chambre clarence","info":"","x":350,"y":1460,"wires":[]},{"id":"a2232bdb6581fc0d","type":"switch","z":"63ef5fda.dd974","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"},{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"},{"t":"eq","v":"arrow_right_click","vt":"str"},{"t":"eq","v":"arrow_left_click","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":710,"y":1540,"wires":[["faf5ec473bdb9165"],["5bbcc7397750789a"],["cce3af9b6c137f01"],["d72fea2fa6cf67ab"],["cce7ac524907057d"]]},{"id":"7725f723d3f53e57","type":"server-state-changed","z":"63ef5fda.dd974","name":"Telecommande - Clarence","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.telecommande_ikea_chambre_clarence_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":1540,"wires":[["a2232bdb6581fc0d","749c80331638cc37"]]},{"id":"faf5ec473bdb9165","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.lumiere_chambre_clarence"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":1500,"wires":[["7adb4b9a315503a8"]]},{"id":"5bbcc7397750789a","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité +","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_clarence"],"data":"{\"brightness_step_pct\":10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":970,"y":1560,"wires":[[]]},{"id":"cce3af9b6c137f01","type":"api-call-service","z":"63ef5fda.dd974","name":"Luminosité -","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_clarence"],"data":"{\"brightness_step_pct\":-10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":970,"y":1620,"wires":[[]]},{"id":"749c80331638cc37","type":"debug","z":"63ef5fda.dd974","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":640,"y":1480,"wires":[]},{"id":"d72fea2fa6cf67ab","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"input_number","service":"increment","areaId":[],"deviceId":[],"entityId":["input_number.color_select_chambre_rue"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":720,"y":1680,"wires":[["bc29350ef27af4ef"]]},{"id":"3989e560190c3209","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_clarence"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1350,"y":1760,"wires":[[]]},{"id":"1864e74ff9fbb3e3","type":"function","z":"63ef5fda.dd974","name":"","func":"msg.payload = \n    {\n    data: {\n    \n    xy_color: msg.payloadxy\n    }\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":1680,"wires":[["cd053d811a3d74ba","747683b7502aecfc"]]},{"id":"bc29350ef27af4ef","type":"api-render-template","z":"63ef5fda.dd974","name":"yx","server":"43d85569dace75e0","version":0,"template":"[{{state_attr('sensor.color_template_chambre_rue', 'x') | float}},{{state_attr('sensor.color_template_chambre_rue', 'y') | float}}]","resultsLocation":"payloadxy","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1010,"y":1680,"wires":[["1864e74ff9fbb3e3"]]},{"id":"7adb4b9a315503a8","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.lumiere_chambre_rue"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":1500,"wires":[[]]},{"id":"33574e61b3faadd5","type":"function","z":"63ef5fda.dd974","name":"","func":"msg.payload = \n    {\n    data: {\n    \n    xy_color: msg.payloadxy\n    }\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1160,"y":1760,"wires":[["3989e560190c3209"]]},{"id":"7197cfe7c1876a5d","type":"api-render-template","z":"63ef5fda.dd974","name":"yx","server":"43d85569dace75e0","version":0,"template":"[{{state_attr('sensor.color_template_chambre_rue', 'x') | float}},{{state_attr('sensor.color_template_chambre_rue', 'y') | float}}]","resultsLocation":"payloadxy","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":990,"y":1760,"wires":[["33574e61b3faadd5"]]},{"id":"cd053d811a3d74ba","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_clarence"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1390,"y":1680,"wires":[[]]},{"id":"cce7ac524907057d","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"input_number","service":"decrement","areaId":[],"deviceId":[],"entityId":["input_number.color_select_chambre_rue"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":690,"y":1760,"wires":[["7197cfe7c1876a5d"]]},{"id":"747683b7502aecfc","type":"debug","z":"63ef5fda.dd974","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1380,"y":1640,"wires":[]},{"id":"7de4720955b4f73b","type":"api-current-state","z":"63ef5fda.dd974","name":"Is light garage on ?","server":"43d85569dace75e0","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.multilevel_power_switch_instance_1_level","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":450,"y":233,"wires":[["b640a4ca5505633c"],["0447dd138dc2f62b"]]},{"id":"b640a4ca5505633c","type":"stoptimer","z":"63ef5fda.dd974","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":860,"y":200,"wires":[["187417ec97ce20a6"],[]]},{"id":"187417ec97ce20a6","type":"api-call-service","z":"63ef5fda.dd974","name":"Lumière garage OFF","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.multilevel_power_switch_instance_1_level"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1180,"y":280,"wires":[[]]},{"id":"02e26cb3b14808c6","type":"inject","z":"63ef5fda.dd974","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":440,"wires":[["187417ec97ce20a6"]]},{"id":"a5229b1802f0c1b7","type":"comment","z":"63ef5fda.dd974","name":"LED ELOISE","info":"","x":70,"y":2360,"wires":[]},{"id":"f212209f49a0e1e2","type":"comment","z":"63ef5fda.dd974","name":"LED BUREAU","info":"## Ruban Salon","x":70,"y":2000,"wires":[]},{"id":"77beb284e2993c19","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\",\n    data:\n    {\"rgb_color\": msg.rgb, \"brightness\":msg.bri}\n};\nif (msg.payload === \"off\") msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":1820,"wires":[["43b6df184713acdb"]]},{"id":"43b6df184713acdb","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_clarence"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":970,"y":1820,"wires":[[]]},{"id":"f8b6ac407bc8225a","type":"comment","z":"63ef5fda.dd974","name":"Eclairage chambre clarence","info":"","x":120,"y":1400,"wires":[]},{"id":"74128ea353a4629c","type":"comment","z":"63ef5fda.dd974","name":"Ampoule clarence","info":"","x":110,"y":1760,"wires":[]},{"id":"e5b3a3e2f04b2ed4","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["switch.lumiere_chambre_rue"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":970,"y":1880,"wires":[[]]},{"id":"a113387972c5ad64","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n  \n};\nif (msg.payload === \"off\") msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":1880,"wires":[["e5b3a3e2f04b2ed4"]]},{"id":"2e262a9a8c609d1c","type":"comment","z":"63ef5fda.dd974","name":"Lumière chambre parents","info":"","x":1250,"y":1140,"wires":[]},{"id":"1746e7bf75e2afcf","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\",\n    data:\n    {\"rgb_color\": msg.rgb, \"brightness\":msg.bri}\n};\nif (msg.payload === \"off\") msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1440,"y":1220,"wires":[["2a2d35510d8912f2","aff8042bafcea17e"]]},{"id":"2a2d35510d8912f2","type":"api-call-service","z":"63ef5fda.dd974","name":"switch lumière parents","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["switch.lumiere_chambre_parents"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":1220,"wires":[[]]},{"id":"7724f17fa2d10415","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\",\n    data:\n    {\"rgb_color\": msg.rgb, \"brightness\":msg.bri}\n};\nif (msg.payload === \"off\") msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1440,"y":1280,"wires":[["7506b655051ed39e"]]},{"id":"7506b655051ed39e","type":"api-call-service","z":"63ef5fda.dd974","name":"Ampoules parents","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["light.ampoule_chambre_parents_1","light.ampoule_chambre_parents_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1630,"y":1280,"wires":[[]]},{"id":"29a98c6e807166e6","type":"debug","z":"63ef5fda.dd974","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1250,"y":1060,"wires":[]},{"id":"57769d640dd054f0","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["light.led_bureau"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":970,"y":2140,"wires":[[]]},{"id":"668c06665e74e917","type":"server-state-changed","z":"63ef5fda.dd974","name":"isComputerBureauOn?","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.onoff_bureau_salon_electric_consumed_w_3","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":2200,"wires":[["ac6953616f91c1e3"]]},{"id":"ac6953616f91c1e3","type":"and-gate","z":"63ef5fda.dd974","name":"","rules":[{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"},{"t":"gt","v":"50","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.onoff_bureau_salon_electric_consumed_w_3"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":540,"y":2140,"wires":[["9df90b80b46a613f"]]},{"id":"5d84b44ef97fde27","type":"server-state-changed","z":"63ef5fda.dd974","name":"Lumière garage - ND","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.lumiere_garage_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":280,"y":360,"wires":[["0db298764bad02fa"]]},{"id":"512a2e2b81b2266a","type":"server-state-changed","z":"63ef5fda.dd974","name":"Lumière garage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.multilevel_power_switch_instance_1_level","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":400,"y":100,"wires":[["6d33f7dfd6ddcc95"]]},{"id":"6d33f7dfd6ddcc95","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\",\n    \n};\nif (msg.payload === \"off\")\nmsg.payload = \n{\n    \"service\":\"turn_off\",\n    \n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":100,"wires":[["3a3497aa9c8a4ef4"]]},{"id":"3a3497aa9c8a4ef4","type":"api-call-service","z":"63ef5fda.dd974","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"","service":"","areaId":[],"deviceId":[],"entityId":["input_boolean.lumiere_garage_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":890,"y":100,"wires":[[]]},{"id":"0db298764bad02fa","type":"switch","z":"63ef5fda.dd974","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":360,"wires":[["7de4720955b4f73b"],["187417ec97ce20a6"]]},{"id":"1dec0851c77b798c","type":"function","z":"63ef5fda.dd974","name":"Code pour led","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\",\n    data:\n    {\"rgb_color\": msg.rgb, \"brightness\":msg.bri}\n};\nif (msg.payload === \"off\") msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":2360,"wires":[[]]},{"id":"447406d6b82d1211","type":"api-call-service","z":"63ef5fda.dd974","name":"Led Eloise","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["light.led_eloise"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1050,"y":2460,"wires":[[]]},{"id":"a6bb8f58ecc3ee01","type":"server-state-changed","z":"63ef5fda.dd974","name":"isEloiseComputerOn?","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.prise_bureau_eloise_energy","entityidfiltertype":"substring","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":400,"y":2520,"wires":[["79eec05e3bf9a12c"]]},{"id":"79eec05e3bf9a12c","type":"and-gate","z":"63ef5fda.dd974","name":"","rules":[{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"},{"t":"gt","v":"20","vt":"num","propertyType":"msg","property":"payload","topic":"sensor.prise_bureau_eloise_energy"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":600,"y":2460,"wires":[["e3c423c3aaaa92a0"]]},{"id":"8041b22aed70afd7","type":"server-state-changed","z":"63ef5fda.dd974","name":"Lumière clarence","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.lumiere_clarence_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":420,"y":1860,"wires":[["77beb284e2993c19","a113387972c5ad64"]]},{"id":"d9b21dd0ad9fee73","type":"server-state-changed","z":"63ef5fda.dd974","name":"Lumière parents nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.lumiere_parents_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1230,"y":1260,"wires":[["1746e7bf75e2afcf","7724f17fa2d10415"]]},{"id":"aff8042bafcea17e","type":"api-call-service","z":"63ef5fda.dd974","name":"Lumière parents nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.lumiere_parents_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1630,"y":1160,"wires":[[]]},{"id":"00cbd00a840bc243","type":"server-state-changed","z":"63ef5fda.dd974","name":"isHomecinéOn ?","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.prise_homecinema_electric_consumed_w_2","entityidfiltertype":"substring","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":400,"y":2840,"wires":[["8557e96049713067"]]},{"id":"8557e96049713067","type":"and-gate","z":"63ef5fda.dd974","name":"","rules":[{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"},{"t":"gt","v":"35","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.prise_homecinema_electric_consumed_w_2"}],"outputTopic":"test","gateType":"and","emitOnlyIfTrue":false,"x":600,"y":2780,"wires":[["3bca6b113f36af10"]]},{"id":"3bca6b113f36af10","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n    \n};\nif (msg.bool === false) msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":2780,"wires":[["91a175fce5771d9f"]]},{"id":"91a175fce5771d9f","type":"api-call-service","z":"63ef5fda.dd974","name":"Ampoule salon","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["light.ampoule_salon"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1040,"y":2780,"wires":[[]]},{"id":"fc1931e6a6640bc8","type":"comment","z":"63ef5fda.dd974","name":"Ampoule Salon","info":"","x":100,"y":2680,"wires":[]},{"id":"9df90b80b46a613f","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n    \n};\nif (msg.bool === false) msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":2140,"wires":[["57769d640dd054f0"]]},{"id":"e3c423c3aaaa92a0","type":"function","z":"63ef5fda.dd974","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n    \n};\nif (msg.bool === false) msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":2460,"wires":[["447406d6b82d1211"]]},{"id":"ec201e1ae0ea9190","type":"link in","z":"63ef5fda.dd974","name":"Led bureau","links":["7c6830aa8a855fd3"],"x":370,"y":2100,"wires":[["ac6953616f91c1e3","19bb252819ada1d8"]],"l":true},{"id":"b75d6df5c3d3d33c","type":"link in","z":"63ef5fda.dd974","name":"Led eloise","links":["7c6830aa8a855fd3"],"x":360,"y":2420,"wires":[["79eec05e3bf9a12c"]],"l":true},{"id":"72b05815a19e251e","type":"link in","z":"63ef5fda.dd974","name":"Ampoule Salon","links":["7c6830aa8a855fd3"],"x":380,"y":2700,"wires":[["8557e96049713067","5176060ffe7a1552"]],"l":true},{"id":"19bb252819ada1d8","type":"debug","z":"63ef5fda.dd974","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":550,"y":2020,"wires":[]},{"id":"5176060ffe7a1552","type":"debug","z":"63ef5fda.dd974","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":2620,"wires":[]},{"id":"e2e25e792ec57ee9","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur Sam - Confort","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.radiateur_sam"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":160,"wires":[[]]},{"id":"392823b42515bb5c","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage buanderie","info":"","x":170,"y":460,"wires":[]},{"id":"98f74902da0bb149","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage SAM","info":"","x":180,"y":60,"wires":[]},{"id":"04be2aebef9a1318","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur Cuisine - Confort","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.radiateur_cuisine"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1240,"y":940,"wires":[[]]},{"id":"48eaba83bbab6c83","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_cuisine', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_cuisine', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1040,"y":880,"wires":[[]]},{"id":"ddb906c06a881220","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage cuisine","info":"","x":190,"y":740,"wires":[]},{"id":"83b0b7b2533d3339","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanComfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_sam', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_sam', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1210,"y":280,"wires":[[]],"outputLabels":["true"]},{"id":"39cc21d6da081a70","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage chambre Eloise","info":"","x":210,"y":1140,"wires":[]},{"id":"f81b9394463377de","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur jardin","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.radiateur_ch_jardin"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1040,"y":1300,"wires":[[]]},{"id":"248a0861f6b75066","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_ch_jardin', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_ch_jardin', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":780,"y":1380,"wires":[[]]},{"id":"2c0dac6784c5c517","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage chambre parents","info":"","x":220,"y":1500,"wires":[]},{"id":"6e00c75adaa860a9","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur parents ","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.radiateur_ch_parents"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":1660,"wires":[[]]},{"id":"eb6442e395457d3f","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_ch_parents', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_ch_parents', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":860,"y":1600,"wires":[[]]},{"id":"ec6d337e8ebeded1","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <19","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_chjardin_bt_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":410,"y":1360,"wires":[["8d8423fab6ceef84"]]},{"id":"9afdb852ea3fedea","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isComputerOn","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.onoff_bureau_salon_electric_consumed_w_3","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":250,"y":320,"wires":[["3b28f871af37f07f"]]},{"id":"1382b7adc6a3ec0d","type":"and-gate","z":"7a831b6e2f802ee7","name":"AND","rules":[{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.portable_pascal"},{"t":"lt","v":"21","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_sam_bt_temperature_2"},{"t":"true","propertyType":"msg","property":"payload","topic":"OrGate"}],"outputTopic":"titi","gateType":"and","emitOnlyIfTrue":false,"x":810,"y":160,"wires":[["41f81abe4907c83b"]],"icon":"node-red-contrib-bool-gate/and.png"},{"id":"3b28f871af37f07f","type":"or-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"gt","v":"50","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.onoff_bureau_salon_electric_consumed_w_3"},{"t":"gt","v":"40","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.prise_tv_salon_energy"}],"outputTopic":"OrGate","gateType":"or","emitOnlyIfTrue":true,"x":520,"y":280,"wires":[["1382b7adc6a3ec0d"]]},{"id":"6962cc75a4cf0643","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <21","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_sam_bt_temperature_2","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lte","outputs":1,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":510,"y":160,"wires":[["1382b7adc6a3ec0d"]]},{"id":"6b2c10ae38173426","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTvOn","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.prise_tv_salon_energy","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"gte","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"true","valueType":"bool"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":250,"y":240,"wires":[["3b28f871af37f07f"]]},{"id":"8d8423fab6ceef84","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.eloise_telephone"},{"t":"lt","v":"19","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_chjardin_bt_temperature"},{"t":"false","propertyType":"msg","property":"payload","topic":"EloiseCalendrier"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":660,"y":1300,"wires":[["7785be8fc1d00f4d"]]},{"id":"6ff256fd4a9b8d43","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"lt","v":"19","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_cuisine_bt_temperature"},{"t":"true","propertyType":"msg","property":"payload","topic":"calendrierCuisine"},{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":840,"y":940,"wires":[["02c772c37d9849e1"]]},{"id":"b03292d8964ae0b0","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp < 19","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_cuisine_bt_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"true","valueType":"bool"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":620,"y":940,"wires":[["6ff256fd4a9b8d43"]]},{"id":"d002f596873981b8","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_buanderie', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_buanderie', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1100,"y":660,"wires":[[]]},{"id":"d647120d8ba1c98b","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"lt","v":"19","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_buanderie_bt_temperature"},{"t":"true","propertyType":"msg","property":"payload","topic":"calendrierBuanderie"},{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.stephanie_telephone"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":820,"y":580,"wires":[["0d4bf9378cdbfa80"]]},{"id":"6b252d70a50167ed","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp < 19","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_buanderie_bt_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":570,"y":620,"wires":[["d647120d8ba1c98b"]]},{"id":"1ce87e1e2fe04f14","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur Buanderie - Confort","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.radiateur_buanderie"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1250,"y":580,"wires":[[]]},{"id":"078843ba91f95bdb","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage chambre Clarence","info":"","x":220,"y":1860,"wires":[]},{"id":"4f4302cb8180ee19","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_ch_rue', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_ch_rue', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":880,"y":1980,"wires":[[]]},{"id":"396b905b2bda0080","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <19","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_chclarence_bt_temperature_2","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"true","valueType":"bool"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":2020,"wires":[["1848dfc6be8b3ffa"]]},{"id":"1848dfc6be8b3ffa","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.clarence_telephone"},{"t":"lt","v":"19","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_chclarence_bt_temperature"},{"t":"true","propertyType":"msg","property":"payload","topic":"ClarenceCalendrier"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":600,"y":2040,"wires":[["082244c82245eb87"]]},{"id":"092d70bd9122ee49","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage Entree","info":"","x":180,"y":2220,"wires":[]},{"id":"dc244e3018fd4c4b","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if states('light.radiateur_entree_level') != 'on' }}\n{{false if states('light.radiateur_entree_level') == 'on' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":820,"y":2440,"wires":[[]]},{"id":"3ed39797df303e3c","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <19","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_entree_bt_temperature_2","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":2380,"wires":[["f737a74a01c13583"]]},{"id":"f737a74a01c13583","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"},{"t":"lt","v":"19","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_entree_bt_temperature_2"},{"t":"false","propertyType":"msg","property":"payload","topic":"CalendrierEntree"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":640,"y":2380,"wires":[["f3b9ce8587e0fdc7"]]},{"id":"146798c3a6974e7d","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage SDB","info":"","x":180,"y":2620,"wires":[]},{"id":"e29e4a10aacb3969","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_sdb', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_sdb', 'preset_mode') == 'comfort' }} ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":860,"y":2760,"wires":[[]]},{"id":"9bf75937d8c1116d","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <22","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_sdb_bt_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"22","halt_if_type":"num","halt_if_compare":"lt","outputs":2,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"true","valueType":"bool"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":390,"y":2800,"wires":[["86899949152ec32d"],[]]},{"id":"86899949152ec32d","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"},{"t":"true","propertyType":"msg","property":"payload","topic":"sensor.temp_sdb_bt_temperature"},{"t":"true","propertyType":"msg","property":"payload","topic":"CalendrierSDB"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":650,"y":2840,"wires":[["bad80b42960366ce"]]},{"id":"e3346b1ef554ab32","type":"comment","z":"7a831b6e2f802ee7","name":"Chauffage Couloir etage","info":"","x":210,"y":3100,"wires":[]},{"id":"39a9868a94b62a4f","type":"inject","z":"7a831b6e2f802ee7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":560,"y":3400,"wires":[[]]},{"id":"4da9bc33eca06bfd","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <19","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_chparents_bt_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":1640,"wires":[["22acab99ee18cb33"]]},{"id":"22acab99ee18cb33","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"true","propertyType":"msg","property":"payload","topic":"orGate"},{"t":"lt","v":"19","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_chparents_bt_temperature"},{"t":"false","propertyType":"msg","property":"payload","topic":"pascalCalendrier"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":640,"y":1660,"wires":[["c07a7234a278bb9e"]]},{"id":"5f84210c843e6c77","type":"link in","z":"7a831b6e2f802ee7","name":"Planification nuit - chambre parentale","links":["8f037705b88d191b"],"x":330,"y":1700,"wires":[["22acab99ee18cb33"]],"l":true},{"id":"36cf861f20879d52","type":"link in","z":"7a831b6e2f802ee7","name":"Planification chauffage nuit - chambre clarence","links":["8f037705b88d191b"],"x":510,"y":2080,"wires":[["1848dfc6be8b3ffa"]],"l":true},{"id":"ade3db62a58d1519","type":"link in","z":"7a831b6e2f802ee7","name":"Planification chauffage nuit - Entree","links":["8f037705b88d191b"],"x":455,"y":2460,"wires":[["f737a74a01c13583"]]},{"id":"29fbdb3bdfc73afe","type":"link in","z":"7a831b6e2f802ee7","name":"Planification chauffage nuit - Eloîse","links":["8f037705b88d191b"],"x":340,"y":1300,"wires":[["8d8423fab6ceef84"]],"l":true},{"id":"574ea8a16e0e5e40","type":"link in","z":"7a831b6e2f802ee7","name":"Planification SDB - chauffage","links":["56d5d7f26c66f602"],"x":445,"y":2880,"wires":[["86899949152ec32d"]]},{"id":"1790e4cb6e09093c","type":"link in","z":"7a831b6e2f802ee7","name":"Planification SDB - chauffage-  Chauffage cuisine","links":["4d1f3537c1b54fee"],"x":520,"y":1000,"wires":[["6ff256fd4a9b8d43"]],"l":true},{"id":"0d0c5ad07af9abee","type":"link in","z":"7a831b6e2f802ee7","name":"Planification Buanderie - chauffage","links":["315fa278c4352517"],"x":540,"y":560,"wires":[["d647120d8ba1c98b"]],"l":true},{"id":"20a0a4870c67c998","type":"link in","z":"7a831b6e2f802ee7","name":"isPascalHome - home","links":["bad489de84f4a868"],"x":540,"y":80,"wires":[["1382b7adc6a3ec0d"]],"l":true},{"id":"2f4dc3a9426aea21","type":"link in","z":"7a831b6e2f802ee7","name":"isStephanieHome - home","links":["4bfd02bf4bccc494"],"x":630,"y":500,"wires":[["d647120d8ba1c98b"]],"l":true},{"id":"3cd247daf365b2fd","type":"link in","z":"7a831b6e2f802ee7","name":"isClarenceHome - home","links":["4a76006d167611ed"],"x":290,"y":1980,"wires":[["1848dfc6be8b3ffa"]],"l":true},{"id":"49592774c4355c50","type":"link in","z":"7a831b6e2f802ee7","name":"isEloiseHome -  home","links":["1ee2a23c251bedc6"],"x":400,"y":1240,"wires":[["8d8423fab6ceef84"]],"l":true},{"id":"82307e5bfd0f81ec","type":"api-render-template","z":"7a831b6e2f802ee7","name":"IsOnOtherPresetThanConfort","server":"43d85569dace75e0","version":0,"template":"{{true if state_attr('climate.radiateur_couloir_etage', 'preset_mode') != 'comfort' }}\n{{false if state_attr('climate.radiateur_couloir_etage', 'preset_mode') == 'comfort' }}  ","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1260,"y":3340,"wires":[[]]},{"id":"571cf81cb62d0e19","type":"function","z":"7a831b6e2f802ee7","name":"Notification - mode confort","func":"msg.payload =\n\n\"Passage du radiateur couloir etage en mode confort\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":3400,"wires":[["04124635d4d354a6"]]},{"id":"04124635d4d354a6","type":"link out","z":"7a831b6e2f802ee7","name":"VersEchos","mode":"link","links":[],"x":990,"y":3400,"wires":[],"l":true},{"id":"299c19fc2fc0c7a4","type":"server-state-changed","z":"7a831b6e2f802ee7","name":"isTemp <18","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temp_couloiretage_bt_temperature","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","outputs":1,"output_only_on_state_change":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":330,"y":3340,"wires":[["b02334ea6f48bfe7","8cd83a4fa47ef71f"]]},{"id":"b02334ea6f48bfe7","type":"and-gate","z":"7a831b6e2f802ee7","name":"","rules":[{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"},{"t":"lt","v":"18","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.temp_couloiretage_bt_temperature"},{"t":"false","propertyType":"msg","property":"payload","topic":"CalendrierNuit"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":false,"x":560,"y":3260,"wires":[["ff8afb9608436ed6"]]},{"id":"c01800f3bbf64032","type":"link in","z":"7a831b6e2f802ee7","name":"Planification chauffage nuit - Couloir","links":["8f037705b88d191b"],"x":335,"y":3280,"wires":[["b02334ea6f48bfe7"]]},{"id":"ff8afb9608436ed6","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":3260,"wires":[["958c5106e9e98976"]]},{"id":"958c5106e9e98976","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur couloir- Confort","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"","areaId":[],"deviceId":[],"entityId":["climate.radiateur_couloir_etage"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1030,"y":3260,"wires":[[]]},{"id":"206ca0e256606cfd","type":"link in","z":"7a831b6e2f802ee7","name":"IsFamillyHome","links":["7cc76cb3055d7e49"],"x":380,"y":3200,"wires":[["b02334ea6f48bfe7","497bc1cc7a3a4101"]],"l":true},{"id":"497bc1cc7a3a4101","type":"debug","z":"7a831b6e2f802ee7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":610,"y":3160,"wires":[]},{"id":"19a0a665f63b1f3b","type":"link in","z":"7a831b6e2f802ee7","name":"IsFamillyHome","links":["7cc76cb3055d7e49","5726c0d3f5a00184"],"x":480,"y":2720,"wires":[["86899949152ec32d"]],"l":true},{"id":"bad80b42960366ce","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":2840,"wires":[["98f47b27540a8e84"]]},{"id":"98f47b27540a8e84","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur SDB ","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"","areaId":[],"deviceId":[],"entityId":["climate.radiateur_sdb"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1040,"y":2840,"wires":[[]]},{"id":"8cd83a4fa47ef71f","type":"debug","z":"7a831b6e2f802ee7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":590,"y":3480,"wires":[]},{"id":"871aea2b3fcafe83","type":"link in","z":"7a831b6e2f802ee7","name":"IsFamillyHome","links":["7cc76cb3055d7e49"],"x":460,"y":2320,"wires":[["f737a74a01c13583"]],"l":true},{"id":"f3b9ce8587e0fdc7","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n    \n};\nif (msg.bool === false) msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":2380,"wires":[["b7b204af96b33a9a"]]},{"id":"b7b204af96b33a9a","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur Entree ","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"light","service":"","areaId":[],"deviceId":[],"entityId":["climate.radiateur_entree"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":2380,"wires":[[]]},{"id":"082244c82245eb87","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":2040,"wires":[["e2e32e63c6be0449"]]},{"id":"e2e32e63c6be0449","type":"api-call-service","z":"7a831b6e2f802ee7","name":"Radiateur Clarence","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"climate","service":"","areaId":[],"deviceId":[],"entityId":["climate.radiateur_ch_rue"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":2040,"wires":[[]]},{"id":"a64ccc3d67ad8a44","type":"link in","z":"7a831b6e2f802ee7","name":"IsFamillyHome","links":["7cc76cb3055d7e49"],"x":380,"y":1580,"wires":[["22acab99ee18cb33"]],"l":true},{"id":"c07a7234a278bb9e","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":1660,"wires":[["6e00c75adaa860a9"]]},{"id":"02c772c37d9849e1","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1000,"y":940,"wires":[["04be2aebef9a1318"]]},{"id":"7785be8fc1d00f4d","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":1300,"wires":[["f81b9394463377de"]]},{"id":"caeb02f4ca4a2319","type":"link in","z":"7a831b6e2f802ee7","name":"IsFamillyHome","links":["7cc76cb3055d7e49"],"x":620,"y":880,"wires":[["6ff256fd4a9b8d43"]],"l":true},{"id":"0d4bf9378cdbfa80","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":580,"wires":[["1ce87e1e2fe04f14"]]},{"id":"41f81abe4907c83b","type":"function","z":"7a831b6e2f802ee7","name":"","func":"if (msg.bool === true)\nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n     data:\n    {\"preset_mode\":\"comfort\"},\n};\nif (msg.bool === false) \nmsg.payload = \n{\n    \"service\":\"set_preset_mode\",\n    data:\n    {\"preset_mode\":\"eco\"},\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":160,"wires":[["e2e25e792ec57ee9"]]},{"id":"78cae640b0ed2b99","type":"server-state-changed","z":"2751f6a3a0a7649a","name":"Alarme HA","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"alarm_control_panel.alarme_maison","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":80,"y":240,"wires":[["d248d9b79a7ec1c0","2ad61e6cbb9096da"]]},{"id":"d248d9b79a7ec1c0","type":"debug","z":"2751f6a3a0a7649a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":350,"y":80,"wires":[]},{"id":"2ad61e6cbb9096da","type":"switch","z":"2751f6a3a0a7649a","name":"Statuts alarme","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"arming","vt":"str"},{"t":"eq","v":"disarmed","vt":"str"},{"t":"eq","v":"armed_home","vt":"str"},{"t":"eq","v":"armed_away","vt":"str"},{"t":"eq","v":"armed_night","vt":"str"},{"t":"eq","v":"pending","vt":"str"},{"t":"eq","v":"triggered","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":380,"y":200,"wires":[["493c93f78440a357"],["17259af75856254d"],["b1b7b1de92e8987b"],["b1b7b1de92e8987b"],["1787f31cd6d3f5d8"],["e9d0ba7fd412237b"],["29a8ac0256bc867e"]]},{"id":"1c62624d970e0122","type":"function","z":"2751f6a3a0a7649a","name":"Activation de l'alarme","func":"msg.payload =\n\n\"Activation de l'alarme\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":660,"wires":[["c858a79d18d17e42"]]},{"id":"c858a79d18d17e42","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["22186f7a74fec36f","34dd5813f28f2a42","93d062bbf9af5c89","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":680,"y":660,"wires":[],"l":true},{"id":"e1695473f4f5eed7","type":"function","z":"2751f6a3a0a7649a","name":"Alarme activée - Totale","func":"msg.payload =\n\n\"Alarme activée en mode totale\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":1020,"wires":[["5f0e93f64df35d1d"]]},{"id":"0947ee6869defae6","type":"function","z":"2751f6a3a0a7649a","name":"Alarme activée - nuit","func":"msg.payload =\n\n\"Alarme en mode nuit activée!!\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":1200,"wires":[["c2a0c5b8ddc1f615"]]},{"id":"c2a0c5b8ddc1f615","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - ECHO","mode":"link","links":["34dd5813f28f2a42","d3a1124a6206c675"],"x":990,"y":1200,"wires":[],"l":true},{"id":"e9d0ba7fd412237b","type":"function","z":"2751f6a3a0a7649a","name":"Rappel désactivation alarme","func":"msg.payload =\n\n\"Veuillez désactiver l'alarme!\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":920,"y":280,"wires":[["6d623f5a467da3f4"]]},{"id":"673cea63e6db801d","type":"switch","z":"2751f6a3a0a7649a","name":"Etat précédent ?","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"eq","v":"armed_away","vt":"str"},{"t":"eq","v":"armed_home","vt":"str"},{"t":"eq","v":"armed_night","vt":"str"},{"t":"eq","v":"disarmed","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":520,"y":1920,"wires":[["59120d316859a466","a2a33f915c1c1ab2","95a61b79df5b70fb","7bf7f43e48d0d8ce"],["59120d316859a466","95a61b79df5b70fb","a2a33f915c1c1ab2","7bf7f43e48d0d8ce"],["59120d316859a466","c36957b334d0115d","95a61b79df5b70fb","7bf7f43e48d0d8ce","c91f942ca1af44ee"],["7bf7f43e48d0d8ce"],["7bf7f43e48d0d8ce","59120d316859a466","95a61b79df5b70fb"]]},{"id":"7bf7f43e48d0d8ce","type":"function","z":"2751f6a3a0a7649a","name":"Désactivation de l'alarme","func":"var d = msg.data.old_state.state\nif(d == \"armed_night\")\n{\n    d= \"nuit\"\n}\nif(d == \"armed_away\")\n{\n    d= \"totale\"\n}\nif(d == \"armed_home\")\n{\n    d= \"totale\"\n}\n\n\n\nmsg.payload = \n\n\"Alarme \" + d + \" désactivée \"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":2040,"wires":[["844126695f1020be","e5c665e1ccf84494","b6acabc403e27388"]]},{"id":"844126695f1020be","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram","mode":"link","links":["a7ddbf0dfd2c325b","f550e12c1257457e"],"x":1580,"y":2040,"wires":[],"l":true},{"id":"63f0cbdfdcf05dca","type":"link in","z":"2751f6a3a0a7649a","name":"EtatPrecedent","links":["17259af75856254d","36a98883b42fe8f1"],"x":310,"y":1920,"wires":[["673cea63e6db801d"]],"l":true},{"id":"2eb71b71a5827f45","type":"api-call-service","z":"2751f6a3a0a7649a","name":"eteindre appareils -  group alarme totale","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["group.switchs_alarme_totale","group.switchs_alarme_totale_off"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":420,"y":1020,"wires":[["e1695473f4f5eed7"]]},{"id":"29a8ac0256bc867e","type":"link out","z":"2751f6a3a0a7649a","name":"VersDéclenchemenAlarme - Triggered","mode":"link","links":["a66e966f7f5e94ff"],"x":950,"y":320,"wires":[],"l":true},{"id":"a66e966f7f5e94ff","type":"link in","z":"2751f6a3a0a7649a","name":"DéclenchementAlarme","links":["29a8ac0256bc867e"],"x":200,"y":1560,"wires":[["174f734c3abae27b"]],"l":true},{"id":"aed35cdfa33f2884","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Sirene Entree - ON","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.sirene_entree_switch_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":870,"y":1580,"wires":[[]]},{"id":"174f734c3abae27b","type":"switch","z":"2751f6a3a0a7649a","name":"Etat précédent ?","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"eq","v":"armed_night","vt":"str"},{"t":"else"},{"t":"eq","v":"armed_away","vt":"str"},{"t":"eq","v":"armed_home","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":420,"y":1560,"wires":[["caccd1bf551632db","e3dd133cf84acdf4"],["aed35cdfa33f2884","caccd1bf551632db","29bda6cb1588516b"],["caccd1bf551632db","29bda6cb1588516b","aed35cdfa33f2884"],["caccd1bf551632db","aed35cdfa33f2884","29bda6cb1588516b"]]},{"id":"caccd1bf551632db","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Sirene Garage - ON","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.sirene_garage_switch"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":1520,"wires":[[]]},{"id":"85cd51a497b8d3eb","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["34dd5813f28f2a42","9017154cf2b33cbe","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":1180,"y":1460,"wires":[],"l":true},{"id":"21d3b514b2df5ab9","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["34dd5813f28f2a42","9017154cf2b33cbe","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":1120,"y":1660,"wires":[],"l":true},{"id":"e3dd133cf84acdf4","type":"function","z":"2751f6a3a0a7649a","name":"Intrusion détectée","func":"msg.payload =\n\n\"Attention!!! intrusion détectée \"+\n\"{% for state in states|selectattr('entity_id','in',state_attr('group.alarme_nuit_detecteurs','entity_id'))|selectattr('state','eq','on')|list %}{{state.name+', '}}{%- endfor %}\"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":830,"y":1460,"wires":[["85cd51a497b8d3eb"]]},{"id":"29bda6cb1588516b","type":"function","z":"2751f6a3a0a7649a","name":"Intrusion détectée","func":"msg.payload =\n\n\"Attention!!! intrusion détectée \"+\n\"{% for state in states|selectattr('entity_id','in',state_attr('group.alarme_absence_detecteurs','entity_id'))|selectattr('state','eq','on')|list %}{{state.name+', '}}{%- endfor %}\"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":1660,"wires":[["21d3b514b2df5ab9"]]},{"id":"bc6c28060037d161","type":"comment","z":"2751f6a3a0a7649a","name":"Déclenchement de l'alarme - Triggered","info":"","x":150,"y":1400,"wires":[]},{"id":"910533b15066023c","type":"comment","z":"2751f6a3a0a7649a","name":"Désactivation de l'alarme - Disarmed","info":"","x":140,"y":1800,"wires":[]},{"id":"59120d316859a466","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Sirene Garage - OFF","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.sirene_garage_switch"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":940,"y":1780,"wires":[[]]},{"id":"95a61b79df5b70fb","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Sirene Entree - OFF","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.sirene_entree_switch_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":2120,"wires":[[]]},{"id":"a263eed10af9a065","type":"comment","z":"2751f6a3a0a7649a","name":"Alarme maison","info":"","x":150,"y":60,"wires":[]},{"id":"74c744ec9caa556e","type":"comment","z":"2751f6a3a0a7649a","name":"Alarme incendie","info":"","x":120,"y":2700,"wires":[]},{"id":"f970b39965d85d45","type":"trigger-state","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"group.detecteurs_incendie","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":180,"y":2820,"wires":[["3cf4a2ae07ef6af7"],[]]},{"id":"3cf4a2ae07ef6af7","type":"function","z":"2751f6a3a0a7649a","name":"Incendie détectée","func":"msg.payload =\n\n\"Attention!!! Alerte incendie sur \"+\n\"{% for state in states|selectattr('entity_id','in',state_attr('group.detecteurs_incendie','entity_id'))|selectattr('state','eq','on')|list %}{{state.name+', '}}{%- endfor %}\"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":490,"y":2820,"wires":[["3fcaeebeabb9988c"]]},{"id":"3fcaeebeabb9988c","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["34dd5813f28f2a42","9017154cf2b33cbe","a7ddbf0dfd2c325b","e8df3e37b83f6011","f550e12c1257457e"],"x":820,"y":2820,"wires":[],"l":true},{"id":"c7ca925adf6d6a85","type":"comment","z":"2751f6a3a0a7649a","name":"Alarme inondation","info":"","x":120,"y":3000,"wires":[]},{"id":"7d0ca8a967f452f8","type":"trigger-state","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"group.detecteurs_inondation","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":180,"y":3120,"wires":[["68d87bb68294cbaa"],[]]},{"id":"68d87bb68294cbaa","type":"function","z":"2751f6a3a0a7649a","name":"innondation détectée","func":"msg.payload =\n\n\"Attention!!! Alerte innondation sur \"+\n\"{% for state in states|selectattr('entity_id','in',state_attr('group.detecteurs_inondation','entity_id'))|selectattr('state','eq','on')|list %}{{state.name+', '}}{%- endfor %}\"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":490,"y":3120,"wires":[["e2d4d5c6e5d82874"]]},{"id":"e2d4d5c6e5d82874","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["34dd5813f28f2a42","9017154cf2b33cbe","a7ddbf0dfd2c325b","ced87f2e5d5c0601","d1dc7f1a2fa6359d","e8df3e37b83f6011","f550e12c1257457e"],"x":810,"y":3120,"wires":[],"l":true},{"id":"7411d46daf781256","type":"link out","z":"2751f6a3a0a7649a","name":"VersFermetureDesVolets","mode":"link","links":[],"x":370,"y":960,"wires":[],"l":true},{"id":"c64d35daa715d9ae","type":"cron","z":"2751f6a3a0a7649a","name":"At 6 00 AM","crontab":"00 6 * * *","x":280,"y":3300,"wires":[["04ab28d92c0d179a"]]},{"id":"62e847b6e035621c","type":"function","z":"2751f6a3a0a7649a","name":"Désactivation de l'alarme","func":"msg.payload =\n\n\"Alarme nuit désactivée \"\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1210,"y":3300,"wires":[["d297501805f43348"]]},{"id":"d297501805f43348","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["a7ddbf0dfd2c325b","d3a1124a6206c675","f550e12c1257457e"],"x":1540,"y":3300,"wires":[],"l":true},{"id":"60538268621d4c12","type":"switch","z":"2751f6a3a0a7649a","name":"Statuts alarme","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"armed_night","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":900,"y":3300,"wires":[["62e847b6e035621c","d07fb6e9763629c1"]]},{"id":"04ab28d92c0d179a","type":"api-current-state","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"alarm_control_panel.alarme_maison","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":590,"y":3300,"wires":[["60538268621d4c12"]]},{"id":"a271829be768b26d","type":"comment","z":"2751f6a3a0a7649a","name":"Désactivation auto alarme nuit","info":"","x":120,"y":3220,"wires":[]},{"id":"b26569510a3ffec7","type":"inject","z":"2751f6a3a0a7649a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":600,"y":3220,"wires":[["04ab28d92c0d179a"]]},{"id":"d07fb6e9763629c1","type":"api-call-service","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"alarm_control_panel","service":"alarm_disarm","areaId":[],"deviceId":[],"entityId":["alarm_control_panel.alarme_maison"],"data":"{\"code\":1234}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1230,"y":3240,"wires":[[]]},{"id":"84dbdf798473c6aa","type":"server-state-changed","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"group.alarme_nuit_detecteurs","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":330,"y":2260,"wires":[["ac8b68e030ee609c"],[]]},{"id":"ac8b68e030ee609c","type":"switch","z":"2751f6a3a0a7649a","name":"","property":"homeassistant.homeAssistant.states[\"alarm_control_panel.alarme_maison\"].state","propertyType":"global","rules":[{"t":"eq","v":"armed_night","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":2260,"wires":[["ddcbf2080782378d"]]},{"id":"ddcbf2080782378d","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Passer le statut alarme en triggered","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"alarm_control_panel","service":"alarm_trigger","areaId":[],"deviceId":[],"entityId":["alarm_control_panel.alarme_maison"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":980,"y":2260,"wires":[[]]},{"id":"39c8e2ab1e33c449","type":"comment","z":"2751f6a3a0a7649a","name":"Détécteurs nuit","info":"","x":80,"y":2160,"wires":[]},{"id":"ae571878be0541ac","type":"comment","z":"2751f6a3a0a7649a","name":"Arming","info":"cvcbcvb","x":50,"y":600,"wires":[]},{"id":"493c93f78440a357","type":"link out","z":"2751f6a3a0a7649a","name":"Vers arming","mode":"link","links":["bf3e2e72629f3d47"],"x":870,"y":60,"wires":[],"l":true},{"id":"bf3e2e72629f3d47","type":"link in","z":"2751f6a3a0a7649a","name":"arming","links":["493c93f78440a357"],"x":90,"y":660,"wires":[["1c62624d970e0122"]],"l":true},{"id":"6d623f5a467da3f4","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["34dd5813f28f2a42","a7ddbf0dfd2c325b","ced87f2e5d5c0601","f550e12c1257457e"],"x":1260,"y":280,"wires":[],"l":true},{"id":"5f0e93f64df35d1d","type":"link out","z":"2751f6a3a0a7649a","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["34dd5813f28f2a42","9017154cf2b33cbe","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":1100,"y":1020,"wires":[],"l":true},{"id":"f85f8efd0acc53a8","type":"comment","z":"2751f6a3a0a7649a","name":"ArmedHome ArmedAway","info":"","x":110,"y":900,"wires":[]},{"id":"b1b7b1de92e8987b","type":"link out","z":"2751f6a3a0a7649a","name":"Vers armedHome ArmedAway","mode":"link","links":["e763c87a2725d2ea"],"x":930,"y":180,"wires":[],"l":true},{"id":"e763c87a2725d2ea","type":"link in","z":"2751f6a3a0a7649a","name":"ArmedHome","links":["b1b7b1de92e8987b"],"x":120,"y":1020,"wires":[["2eb71b71a5827f45","7411d46daf781256"]],"l":true},{"id":"f48beb84bb02a523","type":"server-state-changed","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"group.alarme_absence_detecteurs","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":350,"y":2480,"wires":[["aa930caec010be4f"]]},{"id":"aa930caec010be4f","type":"switch","z":"2751f6a3a0a7649a","name":"","property":"homeassistant.homeAssistant.states[\"alarm_control_panel.alarme_maison\"].state","propertyType":"global","rules":[{"t":"eq","v":"armed_away","vt":"str"},{"t":"eq","v":"armed_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":2480,"wires":[["ec0775277a271f4f"],["ec0775277a271f4f"]]},{"id":"ec0775277a271f4f","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Passer le statut alarme en triggered","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"alarm_control_panel","service":"alarm_trigger","areaId":[],"deviceId":[],"entityId":["alarm_control_panel.alarme_maison"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":980,"y":2480,"wires":[[]]},{"id":"5d45e4d5a7e32e48","type":"inject","z":"2751f6a3a0a7649a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":1100,"wires":[[]]},{"id":"c36957b334d0115d","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Re-allumer appareils du groupe Nuit","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["group.switchs_alarme_nuit_on"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":1960,"wires":[[]]},{"id":"63eea20c1362abc4","type":"comment","z":"2751f6a3a0a7649a","name":"Détécteurs journée","info":"","x":90,"y":2400,"wires":[]},{"id":"17259af75856254d","type":"link out","z":"2751f6a3a0a7649a","name":"VersEtatPrécedent","mode":"link","links":["63f0cbdfdcf05dca"],"x":890,"y":120,"wires":[],"l":true},{"id":"e28a4be30a2b1bac","type":"comment","z":"2751f6a3a0a7649a","name":"ArmedNight","info":"","x":70,"y":1140,"wires":[]},{"id":"1787f31cd6d3f5d8","type":"link out","z":"2751f6a3a0a7649a","name":"Vers ArmedNight","mode":"link","links":["424ce7fb3fc9241f"],"x":890,"y":220,"wires":[],"l":true},{"id":"424ce7fb3fc9241f","type":"link in","z":"2751f6a3a0a7649a","name":"ArmedNight","links":["1787f31cd6d3f5d8"],"x":130,"y":1200,"wires":[["4f178d57c03050bf","f1be62ed68e4ca7e"]],"l":true},{"id":"0e0e9f01537a464c","type":"inject","z":"2751f6a3a0a7649a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":700,"wires":[[]]},{"id":"a2a33f915c1c1ab2","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Re-allumer appareils du group alarme totale","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["group.switchs_alarme_totale"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":1880,"wires":[[]]},{"id":"4f178d57c03050bf","type":"api-call-service","z":"2751f6a3a0a7649a","name":"eteindre appareils -  group alarme nuit","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["group.switchs_alarme_nuit_off","group.switchs_alarme_nuit"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":390,"y":1200,"wires":[["0947ee6869defae6"]]},{"id":"f1be62ed68e4ca7e","type":"api-render-template","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":0,"template":"{{ now().timestamp() | timestamp_custom('%Y-%m-%d %H:%M:%S', true)}}","resultsLocation":"payloadStart","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":300,"y":1260,"wires":[["65dfbfb3914d8d4b"]]},{"id":"65dfbfb3914d8d4b","type":"function","z":"2751f6a3a0a7649a","name":"","func":"msg.payload = \n{\n    \"service\":\"add_event\",\n    data:\n    {  \"calendar_id\": \"90kmsfbmhueurlhf74e6od3rc8@group.calendar.google.com\",\n    \"summary\": \"Alarme nuit activée\",\n    \"description\": \"Mise en marche\",\n    \"start_date_time\": msg.payloadStart,\n    \"end_date_time\": msg.payloadStart,\n}\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":1260,"wires":[["0ee63d646fd2ffe9"]]},{"id":"0ee63d646fd2ffe9","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Ajout event sur agenda","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"google","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":790,"y":1260,"wires":[[]]},{"id":"69f4b0159ca35bb1","type":"inject","z":"2751f6a3a0a7649a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":1300,"wires":[["f1be62ed68e4ca7e"]]},{"id":"e5c665e1ccf84494","type":"api-render-template","z":"2751f6a3a0a7649a","name":"","server":"43d85569dace75e0","version":0,"template":"{{ now().timestamp() | timestamp_custom('%Y-%m-%d %H:%M:%S', true)}}","resultsLocation":"payloadStart","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1120,"y":2100,"wires":[["699bc1f10d53c78a"]]},{"id":"699bc1f10d53c78a","type":"function","z":"2751f6a3a0a7649a","name":"","func":"msg.payload = \n{\n    \"service\":\"add_event\",\n    data:\n    {  \"calendar_id\": \"90kmsfbmhueurlhf74e6od3rc8@group.calendar.google.com\",\n    \"summary\":  msg.payload,\n    \"description\": \"Arrêt de l'alarme\",\n    \"start_date_time\": msg.payloadStart,\n    \"end_date_time\": msg.payloadStart,\n}\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1320,"y":2100,"wires":[["d527e18ae73076d9"]]},{"id":"d527e18ae73076d9","type":"api-call-service","z":"2751f6a3a0a7649a","name":"Ajout event sur agenda","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"google","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1610,"y":2100,"wires":[[]]},{"id":"c954e55b86f8d076","type":"link in","z":"2751f6a3a0a7649a","name":"IsFamillyHome","links":["7cc76cb3055d7e49"],"x":360,"y":3400,"wires":[["87fadaca45331ee6"]],"l":true},{"id":"856734cb1d5f2705","type":"server-state-changed","z":"2751f6a3a0a7649a","name":"is early morning ?","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.tot_la_matinee","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":3460,"wires":[["87fadaca45331ee6"]]},{"id":"87fadaca45331ee6","type":"and-gate","z":"2751f6a3a0a7649a","name":"","rules":[{"t":"eq","v":"on","vt":"str","propertyType":"msg","property":"payload","topic":"binary_sensor.tot_la_matinee"},{"t":"true","propertyType":"msg","property":"bool","topic":"orGate"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":true,"x":580,"y":3420,"wires":[["04ab28d92c0d179a"]]},{"id":"c91f942ca1af44ee","type":"debug","z":"2751f6a3a0a7649a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":630,"y":2120,"wires":[]},{"id":"b6acabc403e27388","type":"debug","z":"2751f6a3a0a7649a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1230,"y":2020,"wires":[]},{"id":"8e9ec192cb17c671","type":"api-call-service","z":"96aba16699ebe8be","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.onoff_ballon_eau_chaude_switch"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1540,"y":120,"wires":[["a0f0d77c949b2bfc"]]},{"id":"7e4844206e3e90de","type":"time-range-switch","z":"96aba16699ebe8be","name":"Dans la periode du matin - OFF","lat":"47.0942","lon":"1.6124","startTime":"05:15","endTime":"08:00","startOffset":0,"endOffset":0,"x":710,"y":400,"wires":[["d3c7bf69ce3428eb"],["30d71d67c6e0b768"]]},{"id":"30d71d67c6e0b768","type":"time-range-switch","z":"96aba16699ebe8be","name":"Dans la periode de l'après midi - OFF","lat":"47.0942","lon":"1.6124","startTime":"18:30","endTime":"20:00","startOffset":0,"endOffset":0,"x":1130,"y":400,"wires":[["d3c7bf69ce3428eb"],[]]},{"id":"a0f0d77c949b2bfc","type":"function","z":"96aba16699ebe8be","name":"Notification ballon eau chaude - Arrêt","func":"msg.payload =\n\n\"Arrêt du ballon eau chaude!\"+\n\n\n\"La température de l'eau est de \"+ \n\"{{states('sensor.temperature_ballon_eau_chaude') }}\"+\n\"degrées\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1870,"y":120,"wires":[["8a2c9324ee6ed2b2"]]},{"id":"8a2c9324ee6ed2b2","type":"link out","z":"96aba16699ebe8be","name":"VersEchos","mode":"link","links":["34dd5813f28f2a42","ced87f2e5d5c0601"],"x":2150,"y":160,"wires":[],"l":true},{"id":"672fc88d346d23b7","type":"comment","z":"96aba16699ebe8be","name":"Ballon Eau Chaude","info":"","x":90,"y":60,"wires":[]},{"id":"d3c7bf69ce3428eb","type":"api-current-state","z":"96aba16699ebe8be","name":"IsBallonOn","server":"43d85569dace75e0","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.onoff_ballon_eau_chaude_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1310,"y":120,"wires":[["8e9ec192cb17c671"],[]]},{"id":"0840955ef3add1b5","type":"server-state-changed","z":"96aba16699ebe8be","name":"Temp > 55","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temperature_ballon_eau_chaude","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"55","halt_if_type":"num","halt_if_compare":"gte","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":80,"y":140,"wires":[["d3c7bf69ce3428eb","1f9f809cea1c6a22"],["1f9f809cea1c6a22","7e24f1e71840ad7b"]]},{"id":"7d3b9477f01ab7c8","type":"function","z":"96aba16699ebe8be","name":"Notification ballon eau chaude - Arrêt","func":"msg.payload =\n\n\"La température de l'eau est de \"+ \n\"{{states('sensor.temperature_ballon_eau_chaude') }}\"+\n\"degrées\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":1000,"wires":[["0f99c738b4f311da"]]},{"id":"0f99c738b4f311da","type":"link out","z":"96aba16699ebe8be","name":"VersEchos","mode":"link","links":["22186f7a74fec36f","34dd5813f28f2a42","a7ddbf0dfd2c325b","ced87f2e5d5c0601"],"x":1050,"y":1000,"wires":[],"l":true},{"id":"9ef17043f4fd1ecf","type":"switch","z":"96aba16699ebe8be","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":1000,"wires":[["7d3b9477f01ab7c8","f7801d21c727d156"]]},{"id":"4502dd2721d20c6c","type":"function","z":"96aba16699ebe8be","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n   \n};\nif (msg.payload === \"off\") msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":1100,"wires":[["4656fd08911510c9"]]},{"id":"4656fd08911510c9","type":"api-call-service","z":"96aba16699ebe8be","name":"Ballon eau chaude","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"","areaId":[],"deviceId":[],"entityId":["switch.onoff_ballon_eau_chaude_switch"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":1100,"wires":[[]]},{"id":"07e81328683ac49d","type":"switch","z":"96aba16699ebe8be","name":"Notification","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":580,"wires":[["1b4d4caff8e088e7"],["e7985c5e5416e83d"]]},{"id":"1b4d4caff8e088e7","type":"link out","z":"96aba16699ebe8be","name":"Vers Notification ballon eau chaude - Mise en marche","mode":"link","links":["62f2c18eabcb5ce2"],"x":615,"y":560,"wires":[]},{"id":"e7985c5e5416e83d","type":"link out","z":"96aba16699ebe8be","name":"Notification ballon eau chaude - Arrêt","mode":"link","links":["1cd5e3e64da4a0c6"],"x":615,"y":620,"wires":[]},{"id":"62f2c18eabcb5ce2","type":"link in","z":"96aba16699ebe8be","name":"Notification ballon eau chaude - Mise en marche","links":["1b4d4caff8e088e7"],"x":1615,"y":300,"wires":[["f6ab9782efe2dae9"]]},{"id":"1cd5e3e64da4a0c6","type":"link in","z":"96aba16699ebe8be","name":"Notification ballon eau chaude - Arrêt","links":["e7985c5e5416e83d"],"x":1655,"y":60,"wires":[["a0f0d77c949b2bfc"]]},{"id":"33fc6ae396e83986","type":"debug","z":"96aba16699ebe8be","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1330,"y":960,"wires":[]},{"id":"8c82c8c95efe789d","type":"server-state-changed","z":"96aba16699ebe8be","name":"Temperature eau chaude nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.temperature_eau_chaude_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":1000,"wires":[["9ef17043f4fd1ecf"]]},{"id":"f7801d21c727d156","type":"api-call-service","z":"96aba16699ebe8be","name":"Température eau chaude nd - off","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.temperature_eau_chaude_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":770,"y":920,"wires":[[]]},{"id":"7144b9c00637350f","type":"server-state-changed","z":"96aba16699ebe8be","name":"Ballon eau chaude","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.onoff_ballon_eau_chaude_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":580,"wires":[["07e81328683ac49d"]]},{"id":"c457dbd4752f5bec","type":"time-range-switch","z":"96aba16699ebe8be","name":"Dans la periode du matin - ON","lat":"47.0942","lon":"1.6124","startTime":"03:30","endTime":"05:00","startOffset":0,"endOffset":0,"x":450,"y":220,"wires":[["8f7a4f03f9ba8098"],["7f31a30cfaafafa0"]]},{"id":"8f7a4f03f9ba8098","type":"api-render-template","z":"96aba16699ebe8be","name":"Temp ballon < 42","server":"43d85569dace75e0","version":0,"template":"{{ states.sensor.temperature_ballon_eau_chaude.state | float < 42 }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":950,"y":220,"wires":[["12edcbeaa2ac9378"]]},{"id":"d5911fe47c679169","type":"api-call-service","z":"96aba16699ebe8be","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.onoff_ballon_eau_chaude_switch"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1480,"y":220,"wires":[["f6ab9782efe2dae9"]]},{"id":"f6ab9782efe2dae9","type":"function","z":"96aba16699ebe8be","name":"Notification ballon eau chaude - Mise en marche","func":"msg.payload =\n\n\"Mise en marche du ballon eau chaude!\"+\n\n\n\"La température de l'eau est de \"+ \n\"{{states('sensor.temperature_ballon_eau_chaude') }}\"+\n\"degrées\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1840,"y":220,"wires":[["8a2c9324ee6ed2b2"]]},{"id":"12edcbeaa2ac9378","type":"api-current-state","z":"96aba16699ebe8be","name":"IsBallonOff","server":"43d85569dace75e0","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.onoff_ballon_eau_chaude_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1290,"y":220,"wires":[["d5911fe47c679169"],[]]},{"id":"7f31a30cfaafafa0","type":"time-range-switch","z":"96aba16699ebe8be","name":"Dans la periode de l'après midi - ON","lat":"47.0942","lon":"1.6124","startTime":"16:30","endTime":"19:30","startOffset":0,"endOffset":0,"x":590,"y":300,"wires":[["8f7a4f03f9ba8098"],["7e4844206e3e90de"]]},{"id":"1f9f809cea1c6a22","type":"debug","z":"96aba16699ebe8be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":190,"y":280,"wires":[]},{"id":"7e24f1e71840ad7b","type":"switch","z":"96aba16699ebe8be","name":"","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"number","vt":"number"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":220,"wires":[["c457dbd4752f5bec"]]},{"id":"a2c946eba66eb203","type":"inject","z":"335bd89f27c73b7e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":900,"y":400,"wires":[["93d5ef698a73d77a"]]},{"id":"93d5ef698a73d77a","type":"function","z":"335bd89f27c73b7e","name":"","func":"msg.payload =\n\n\"test de message\"\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":380,"wires":[["eb15cb17b518e3c0"]]},{"id":"34dd5813f28f2a42","type":"link in","z":"335bd89f27c73b7e","name":"VersEchoCuisine","links":["c858a79d18d17e42","8edc6d7303c2db5d","85cd51a497b8d3eb","21d3b514b2df5ab9","cc4b322392797d03","808fc3d6f770457e","a6a57d0ecd2dfa3b","b9e9713fda5bce12","3785c846db38725f","5430e8d9f63ec903","a204df79d980c106","8cb1b630a05f37fb","8a2c9324ee6ed2b2","07eb6ece469c79da","7dc79138d067c52c","5a3d78a114021e01","3fcaeebeabb9988c","e2d4d5c6e5d82874","474620c26f182f77","477d585d0c37ac25","8f66c8e31e0ae6d5","c1f4a02e52dfe300","0d127975593821ca","14a3025c7b125b60","990baf9e01b6a9ce","57ee44c606b96e70","6908e2a3199a31c7","b13a8ab49920bed2","a677cc24a51f5129","15c61d96edec970c","a3ba06745fbaa52e","0465761875be4dce","96be6e4d60ae3a6e","2fe5c6b7ff380b2b","fa12bca9737319c0","6d623f5a467da3f4","5f0e93f64df35d1d","5da72d87bbc0054d","0f99c738b4f311da","561ed58991368f81","6d1b622b3437dd05","c0aba76949d071e3","9d42168c56cd5db2","a557a7b86a26bd4f","c2a0c5b8ddc1f615","b13a88254386f9ea","0b6cff447b63eb2a"],"x":180,"y":140,"wires":[["550cd211c55576d0","42401ddfdfef7cd8"]],"l":true},{"id":"ced87f2e5d5c0601","type":"link in","z":"335bd89f27c73b7e","name":"VersEcoSAM","links":["cc4b322392797d03","808fc3d6f770457e","a6a57d0ecd2dfa3b","b9e9713fda5bce12","3785c846db38725f","5430e8d9f63ec903","a204df79d980c106","8cb1b630a05f37fb","8a2c9324ee6ed2b2","07eb6ece469c79da","7dc79138d067c52c","5a3d78a114021e01","e2d4d5c6e5d82874","474620c26f182f77","477d585d0c37ac25","8f66c8e31e0ae6d5","c1f4a02e52dfe300","0d127975593821ca","14a3025c7b125b60","990baf9e01b6a9ce","57ee44c606b96e70","6908e2a3199a31c7","b13a8ab49920bed2","a677cc24a51f5129","15c61d96edec970c","a3ba06745fbaa52e","0465761875be4dce","b5359c758b2f6f21","7f272b5f9ef785e8","05a88e8e7e8e1416","4708774d67038072","3009b39565906fc8","a223a810b90ddc58","c0393896f8e316ad","e32386ebd0b6b628","fa12bca9737319c0","10a07f1d4d2a297a","0f99c738b4f311da","561ed58991368f81","6d1b622b3437dd05","5f768954e5669639","9d42168c56cd5db2","6d623f5a467da3f4","b13a88254386f9ea","0b6cff447b63eb2a"],"x":170,"y":220,"wires":[["f96d44e481fa03b3"]],"l":true},{"id":"d1dc7f1a2fa6359d","type":"link in","z":"335bd89f27c73b7e","name":"VersEchoClarence","links":["e2d4d5c6e5d82874","b5359c758b2f6f21","7d9904c5006222ba","72eedeac12cbea25","3009b39565906fc8","a223a810b90ddc58","c0393896f8e316ad","10a07f1d4d2a297a","e60ecf28612d47f5"],"x":190,"y":300,"wires":[["b735de666a8c722b"]],"l":true},{"id":"e8df3e37b83f6011","type":"link in","z":"335bd89f27c73b7e","name":"VersEchoEloise","links":["3fcaeebeabb9988c","e2d4d5c6e5d82874","73f1964d1612465e","10a07f1d4d2a297a","659a6c074b508660"],"x":180,"y":380,"wires":[["11dbb202381278fa"]],"l":true},{"id":"a7ddbf0dfd2c325b","type":"link in","z":"335bd89f27c73b7e","name":"VersTelegramPascal","links":["07eb6ece469c79da","0f99c738b4f311da","10a07f1d4d2a297a","1ac313adc77c3f51","21d3b514b2df5ab9","3ee7e5921b77d5cf","3fcaeebeabb9988c","477d585d0c37ac25","561ed58991368f81","5da72d87bbc0054d","5f0e93f64df35d1d","60e510e75983967b","6d623f5a467da3f4","7dc79138d067c52c","844126695f1020be","85cd51a497b8d3eb","86c168a0e72d583a","95326c2d3f13d1e5","96be6e4d60ae3a6e","96f5d3f606ab6e18","990baf9e01b6a9ce","9a92f32be29dff0b","9fe55a906eb625b4","a18a50a53585deab","a223a810b90ddc58","a3ba06745fbaa52e","b51c72fabf8cc164","c0393896f8e316ad","c0aba76949d071e3","c858a79d18d17e42","d297501805f43348","dcb7ae9b918826d0","e2d4d5c6e5d82874","f8c209f18a292223","6d1b622b3437dd05","941a27dd0d638719","7ecfa2c03fcf16a9","fec2926c1d7aebf6"],"x":910,"y":140,"wires":[["3a4fba5c5cf341e9"]],"l":true},{"id":"f550e12c1257457e","type":"link in","z":"335bd89f27c73b7e","name":"VersTelegramStephanie","links":["21d3b514b2df5ab9","3ee7e5921b77d5cf","3fcaeebeabb9988c","5da72d87bbc0054d","5f0e93f64df35d1d","60e510e75983967b","6d623f5a467da3f4","844126695f1020be","85cd51a497b8d3eb","b51c72fabf8cc164","c858a79d18d17e42","d297501805f43348","e2d4d5c6e5d82874","96f5d3f606ab6e18"],"x":920,"y":240,"wires":[["755392b5b77b98e7"]],"l":true},{"id":"22186f7a74fec36f","type":"link in","z":"335bd89f27c73b7e","name":"VersSMSStephanie","links":["3ee7e5921b77d5cf","5da72d87bbc0054d","96be6e4d60ae3a6e","9fe55a906eb625b4","c0aba76949d071e3","c858a79d18d17e42","0f99c738b4f311da","a557a7b86a26bd4f"],"x":170,"y":620,"wires":[["507a42fa5550cfad"]],"l":true},{"id":"93d062bbf9af5c89","type":"link in","z":"335bd89f27c73b7e","name":"VersSMSPascal","links":["07eb6ece469c79da","1ac313adc77c3f51","3ee7e5921b77d5cf","50550b3226604282","5da72d87bbc0054d","7dc79138d067c52c","96be6e4d60ae3a6e","9fe55a906eb625b4","c0aba76949d071e3","c858a79d18d17e42","dea7cdc98f11bbce","31fc7c5bb5a010a5","96f5d3f606ab6e18","62be693784edf59d"],"x":164.0142059326172,"y":700.7329711914062,"wires":[["9951a005e86fa0d8"]],"l":true},{"id":"88f4a6b9887ab019","type":"link in","z":"335bd89f27c73b7e","name":"VersSMSEloise","links":["659a6c074b508660"],"x":160,"y":860,"wires":[["86069a115c5b61a2"]],"l":true},{"id":"343866db0d57e779","type":"link in","z":"335bd89f27c73b7e","name":"VersSMSClarence","links":["7d9904c5006222ba","72eedeac12cbea25","e60ecf28612d47f5"],"x":170,"y":780,"wires":[["eea9762aaf9125e3"]],"l":true},{"id":"f979c8b43295f730","type":"comment","z":"335bd89f27c73b7e","name":"SMS","info":"","x":350,"y":560,"wires":[]},{"id":"145324512d5b0e46","type":"comment","z":"335bd89f27c73b7e","name":"Telegram","info":"","x":1100,"y":80,"wires":[]},{"id":"a047ad67eb2985fe","type":"comment","z":"335bd89f27c73b7e","name":"ECHO","info":"","x":310,"y":40,"wires":[]},{"id":"550cd211c55576d0","type":"debug","z":"335bd89f27c73b7e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":80,"wires":[]},{"id":"d503b3b5b927c0f4","type":"api-call-service","z":"335bd89f27c73b7e","name":"Portier Snapshot","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.portier"],"data":"{\"filename\":\"/config/www/snapshots/snapshots_portier.jpg\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":570,"y":1100,"wires":[["43dda70c5b52fc73"]]},{"id":"d2cf314ff90e5b3f","type":"api-call-service","z":"335bd89f27c73b7e","name":"Envoyer une photo via telegram - Portier","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"telegram_bot","service":"send_photo","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"file\":\"/config/www/snapshots/snapshots_portier.jpg\",\t   \"target\":[246735540, 315573228]\t}\t","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1100,"y":1100,"wires":[["cd58ad44dd8394e1"]]},{"id":"43dda70c5b52fc73","type":"delay","z":"335bd89f27c73b7e","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":800,"y":1100,"wires":[["d2cf314ff90e5b3f"]]},{"id":"cd58ad44dd8394e1","type":"debug","z":"335bd89f27c73b7e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1360,"y":1180,"wires":[]},{"id":"ccdd6a391c5ed645","type":"comment","z":"335bd89f27c73b7e","name":"Telegram - Photo","info":"","x":390,"y":1060,"wires":[]},{"id":"231b1b91f3733db4","type":"link in","z":"335bd89f27c73b7e","name":"TelegramPhotoDoorbird","links":["91019890881dd890","bf524822f4db734d"],"x":295,"y":1100,"wires":[["d503b3b5b927c0f4"]]},{"id":"3a4fba5c5cf341e9","type":"api-call-service","z":"335bd89f27c73b7e","name":"Telegram Pascal","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"telegram_bot","service":"send_message","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":msg.payload,\"title\":\"Message Domotique\",\"target\":246735540}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1330,"y":120,"wires":[[]]},{"id":"755392b5b77b98e7","type":"api-call-service","z":"335bd89f27c73b7e","name":"Telegram Stéphanie","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"telegram_bot","service":"send_message","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"title\":\"Message Domotique\",\t   \"target\":315573228\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1360,"y":260,"wires":[[]]},{"id":"f96d44e481fa03b3","type":"api-call-service","z":"335bd89f27c73b7e","name":"Echo Couloir","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"alexa_media_echo_flex_sam","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\": msg.payload,\t   \"data\":\t            \t            {\t       \"type\":\"announce\"\t            }\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":510,"y":180,"wires":[[]]},{"id":"b735de666a8c722b","type":"api-call-service","z":"335bd89f27c73b7e","name":"Echo Clarence","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"alexa_media_echo_clarence","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\": msg.payload,\t   \"data\":\t            \t            {\t       \"type\":\"announce\"\t            }\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":520,"y":280,"wires":[[]]},{"id":"42401ddfdfef7cd8","type":"api-call-service","z":"335bd89f27c73b7e","name":"Echo Cuisine","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"alexa_media_echo_cuisine","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\": msg.payload,\t   \"data\":\t            \t            {\t       \"type\":\"announce\"\t            }\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":510,"y":80,"wires":[[]]},{"id":"11dbb202381278fa","type":"api-call-service","z":"335bd89f27c73b7e","name":"Echo Eloise","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"alexa_media_echo_eloise","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\": msg.payload,\t   \"data\":\t            \t            {\t       \"type\":\"announce\"\t            }\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":380,"wires":[[]]},{"id":"242cc1bf2145c26e","type":"api-call-service","z":"335bd89f27c73b7e","name":"Echo - Tous","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"alexa_media_partout","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\": msg.payload,\t   \"data\":\t            \t            {\t       \"type\":\"announce\"\t            }\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":460,"wires":[[]]},{"id":"321ba33471679b48","type":"link in","z":"335bd89f27c73b7e","name":"VersTousLesEcho","links":[],"x":190,"y":460,"wires":[["242cc1bf2145c26e"]],"l":true},{"id":"9951a005e86fa0d8","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Pascal","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":638035352\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":700,"wires":[[]]},{"id":"507a42fa5550cfad","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Stéphanie","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":604420252\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":620,"wires":[[]]},{"id":"eea9762aaf9125e3","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Clarence","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":752031947\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":780,"wires":[[]]},{"id":"86069a115c5b61a2","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Eloise","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":651213063\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":860,"wires":[[]]},{"id":"eb15cb17b518e3c0","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Tous","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":[651213063,604420252,752031947,650295195]\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":420,"wires":[[]]},{"id":"29fe90582ddafc5f","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Tous","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":[651213063,604420252,752031947,650295195]\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":940,"wires":[[]]},{"id":"9017154cf2b33cbe","type":"link in","z":"335bd89f27c73b7e","name":"VersSMSTous","links":["21d3b514b2df5ab9","3fcaeebeabb9988c","85cd51a497b8d3eb","e2d4d5c6e5d82874","f08afd7a73f4a1c1","52ce9b2eeac28c0a","617bac76d94e3936","60e510e75983967b","5f0e93f64df35d1d","9d42168c56cd5db2"],"x":150,"y":940,"wires":[["29fe90582ddafc5f"]],"l":true},{"id":"52f1118be7c19138","type":"comment","z":"335bd89f27c73b7e","name":"Tablette","info":"","x":200,"y":1240,"wires":[]},{"id":"86da929d329c8da5","type":"api-call-service","z":"335bd89f27c73b7e","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"rest_command","service":"fully_kiosk_cuisine_cmd","areaId":[],"deviceId":[],"entityId":[],"data":"{\t    \"url\": msg.payload\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":430,"y":1300,"wires":[[]]},{"id":"685bdcecb00a3c9e","type":"link in","z":"335bd89f27c73b7e","name":"VersTabletteCuisine","links":["ecd1b8cfa47eced4","10a07f1d4d2a297a","dcb7ae9b918826d0"],"x":145,"y":1300,"wires":[["86da929d329c8da5"]]},{"id":"19265b14b6c8e543","type":"inject","z":"335bd89f27c73b7e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":1160,"wires":[["d503b3b5b927c0f4"]]},{"id":"57aaf9213ca5863b","type":"link in","z":"335bd89f27c73b7e","name":"VersEchoBureau","links":["c0aba76949d071e3","96be6e4d60ae3a6e","dea7cdc98f11bbce","31fc7c5bb5a010a5","62be693784edf59d","b13a88254386f9ea","e97d3962cf872357","b51c72fabf8cc164","27d3f89a682c1c48","7352a58f1f38b85b"],"x":180,"y":520,"wires":[["1aeac5dd2a6775cb"]],"l":true},{"id":"1aeac5dd2a6775cb","type":"api-call-service","z":"335bd89f27c73b7e","name":"Echo Bureau","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"alexa_media_echo_dot_bureau","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\": msg.payload,\t   \"data\":\t            \t            {\t       \"type\":\"announce\"\t            }\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":520,"wires":[[]]},{"id":"b07e9e2260a8e14c","type":"api-call-service","z":"335bd89f27c73b7e","name":"SMS Parents","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"notify","service":"huawei_lte","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"message\":msg.payload,\t   \"target\":[604420252,650295195]\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":680,"wires":[[]]},{"id":"d3a1124a6206c675","type":"link in","z":"335bd89f27c73b7e","name":"VersSMSParents","links":["d297501805f43348","c2a0c5b8ddc1f615","b13a88254386f9ea"],"x":1060,"y":680,"wires":[["b07e9e2260a8e14c"]],"l":true},{"id":"bfc332e43512aae7","type":"api-call-service","z":"335bd89f27c73b7e","name":"Portier Snapshot","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.portier"],"data":"{\"filename\":\"/config/www/snapshots/snapshots_portier.jpg\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":980,"wires":[["2bb9bdd901519619"]]},{"id":"78d7162f6545c133","type":"api-call-service","z":"335bd89f27c73b7e","name":"Envoyer une photo via telegram - Portier","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"telegram_bot","service":"send_photo","areaId":[],"deviceId":[],"entityId":[],"data":"{\t   \"file\":\"/config/www/snapshots/snapshots_portier.jpg\",\t   \"target\":[246735540, 315573228],\t   \"caption\": \"test\"\t}\t","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1540,"y":980,"wires":[[]]},{"id":"2bb9bdd901519619","type":"delay","z":"335bd89f27c73b7e","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1240,"y":980,"wires":[["78d7162f6545c133"]]},{"id":"80bd2ecb757d4b60","type":"inject","z":"335bd89f27c73b7e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":860,"wires":[["bfc332e43512aae7"]]},{"id":"86386127d4e3d9d1","type":"comment","z":"d9ababc8eca2aa56","name":"Portails - Ouvertures des portails en rentrant","info":"","x":450,"y":60,"wires":[]},{"id":"a7d949351ca82ffc","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Ouverture Portail extérieur","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.portail_exterieur"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":520,"y":280,"wires":[["4e14133c246a780a"]]},{"id":"4e14133c246a780a","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":750,"y":280,"wires":[["9f6a7e6480b35001"]]},{"id":"fd8e5afba706863c","type":"comment","z":"d9ababc8eca2aa56","name":"Ouverture portail garage","info":"","x":250,"y":680,"wires":[]},{"id":"f25e67a3d9b5c2b5","type":"inject","z":"d9ababc8eca2aa56","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":280,"wires":[["a7d949351ca82ffc"]]},{"id":"c96e244f7488b4aa","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Ouverture portail garage","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.portail_garage_switch_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":890,"y":920,"wires":[["25a9b3dfea3749b0","d74ca57d12d01cad"]]},{"id":"3c07fdf0235b59b2","type":"link in","z":"d9ababc8eca2aa56","name":"Ouverture portail garage","links":["88509dc6c4592504"],"x":475,"y":780,"wires":[["b5c05c5e4ed66f8e"]]},{"id":"26fc0810a4d91bde","type":"api-call-service","z":"d9ababc8eca2aa56","name":"fermeture portail garage","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.portail_garage_switch_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":690,"y":1200,"wires":[["2e9de0ce3e1928e8"]]},{"id":"05a4ecb60dabf623","type":"comment","z":"d9ababc8eca2aa56","name":"Fermeture portail garage","info":"","x":250,"y":980,"wires":[]},{"id":"25a9b3dfea3749b0","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1220,"y":920,"wires":[["2cddfa8971abbaa5"]]},{"id":"9780d18bcf46416f","type":"link in","z":"d9ababc8eca2aa56","name":"fermeture portail garage","links":["92d2a8b42e735e94","dfa1855a12f3108d","e61a87dfc270a312"],"x":205,"y":1040,"wires":[["4c0ac7c5dd2a1591"]]},{"id":"7cd448b601c4a9ac","type":"inject","z":"d9ababc8eca2aa56","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":420,"wires":[[]]},{"id":"25df3c958da2fa78","type":"comment","z":"d9ababc8eca2aa56","name":"Portails - Ouverture des portails en sortant","info":"","x":420,"y":400,"wires":[]},{"id":"7ea880440883d771","type":"comment","z":"d9ababc8eca2aa56","name":"Portail extérieur","info":"","x":180,"y":1260,"wires":[]},{"id":"959b7857ae6e42c1","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Ouverture Portail extérieur","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.portail_exterieur"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":700,"y":1380,"wires":[["c8e3314aaab3742e"]]},{"id":"c8e3314aaab3742e","type":"function","z":"d9ababc8eca2aa56","name":"Notification - Ouverture du portail","func":"msg.payload =\n\n\"Ouverture du portail extérieur en cours !\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1140,"y":1380,"wires":[["a3ba06745fbaa52e"]]},{"id":"a3ba06745fbaa52e","type":"link out","z":"d9ababc8eca2aa56","name":"VersEchos","mode":"link","links":["34dd5813f28f2a42","a7ddbf0dfd2c325b","ced87f2e5d5c0601"],"x":1390,"y":1380,"wires":[],"l":true},{"id":"34b7e91a12cecf33","type":"link in","z":"d9ababc8eca2aa56","name":"Ouverture Portail exterieur","links":["b4744f65cdb0c65f"],"x":370,"y":1380,"wires":[["959b7857ae6e42c1"]],"l":true},{"id":"88509dc6c4592504","type":"link out","z":"d9ababc8eca2aa56","name":"Ouverture portail garage","mode":"link","links":["3c07fdf0235b59b2"],"x":990,"y":500,"wires":[],"l":true},{"id":"b4744f65cdb0c65f","type":"link out","z":"d9ababc8eca2aa56","name":"Vers Ouverture portail extérieur","mode":"link","links":["34b7e91a12cecf33"],"x":1530,"y":600,"wires":[],"l":true},{"id":"9b1f159c78e937b5","type":"delay","z":"d9ababc8eca2aa56","name":"Ouverture portail exterieur","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":990,"y":600,"wires":[["b4744f65cdb0c65f","be5dbdf6a1665cb9"]]},{"id":"be5dbdf6a1665cb9","type":"delay","z":"d9ababc8eca2aa56","name":"Fermeture du portail garage","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1470,"y":500,"wires":[["92d2a8b42e735e94"]]},{"id":"92d2a8b42e735e94","type":"link out","z":"d9ababc8eca2aa56","name":"","mode":"link","links":["9780d18bcf46416f"],"x":1715,"y":500,"wires":[]},{"id":"2aeac184d5da1877","type":"comment","z":"d9ababc8eca2aa56","name":"Fermeture des Volets - RDC","info":"","x":420,"y":1560,"wires":[]},{"id":"f91445d4b4ce9fb1","type":"api-call-service","z":"d9ababc8eca2aa56","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.volet_buanderie","cover.volet_cuisine","cover.volet_salon","cover.volet_sam","cover.volet_sam_grand"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":1620,"wires":[[]]},{"id":"4030cce89d67016e","type":"comment","z":"d9ababc8eca2aa56","name":"Fermeture des Volets - Etage","info":"","x":420,"y":1860,"wires":[]},{"id":"430f91079b0bb471","type":"comment","z":"d9ababc8eca2aa56","name":"Fermeture des Volets - RDC et etage","info":"","x":460,"y":2160,"wires":[]},{"id":"fadbfaf796ea21b2","type":"api-call-service","z":"d9ababc8eca2aa56","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":["25dd93fdc28117fa0014ec7b29c9b9bc","cabecaec4a261849f8d06f879af2c721","a0b27f50d1682e0ea76fd286eaeb3b20","cef743e0b64c1b3c0923de4d36730438","714d3596ac90f4fcc58c95259ea16b9e","cd404ff669476c74b93e382e5d808a2f","bee3c2dcb70ef835edc8e78164d2118d","3dce984996219a0b49dd039b9bac3953","c855df1a046c2207f78ffb16685d16ec","04ed3a9cd7241c102da9b90c314edba8","95d0d265a2f21156213ac5cbc303e6a7"],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":910,"y":2320,"wires":[["f68fea43b9c6ce7b","49536083564bc0b9"]]},{"id":"2cddfa8971abbaa5","type":"link out","z":"d9ababc8eca2aa56","name":"","mode":"link","links":[],"x":1485,"y":1040,"wires":[]},{"id":"2ae3214f848836f0","type":"comment","z":"d9ababc8eca2aa56","name":"Portails - exterieur - Intérieur - Auto off","info":"Remise à Off du switch pour permettre la fermeture ou l'ouverture","x":540,"y":2520,"wires":[]},{"id":"b3449546180593ab","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Portail extérieur","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.portail_exterieur","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":2660,"wires":[["348d387009ff4d7a"]]},{"id":"348d387009ff4d7a","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":2660,"wires":[["b36ed40e84092880"]]},{"id":"5d8a252d034b2096","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Portail Garage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.portail_garage_switch_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":230,"y":2780,"wires":[["4ad7b89e82938871"]]},{"id":"4ad7b89e82938871","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":2780,"wires":[["1d70c45745de43d2"]]},{"id":"17430f8bc5941b26","type":"api-call-service","z":"d9ababc8eca2aa56","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.portail_exterieur"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":2660,"wires":[[]]},{"id":"b36ed40e84092880","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":620,"y":2660,"wires":[["17430f8bc5941b26"]]},{"id":"1d70c45745de43d2","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":620,"y":2780,"wires":[["6f220d080ab3d0e9"]]},{"id":"6f220d080ab3d0e9","type":"api-call-service","z":"d9ababc8eca2aa56","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.portail_garage_switch_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":2780,"wires":[[]]},{"id":"2e9de0ce3e1928e8","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":980,"y":1120,"wires":[["2cddfa8971abbaa5"]]},{"id":"71eee179c74ceace","type":"debug","z":"d9ababc8eca2aa56","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":870,"y":2440,"wires":[]},{"id":"a9dc91d57fd0ca7d","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":600,"y":2320,"wires":[["fadbfaf796ea21b2","71eee179c74ceace"],[]]},{"id":"10a07f1d4d2a297a","type":"link out","z":"d9ababc8eca2aa56","name":"VersNotifications - Telegram - SMS - Echo","mode":"link","links":["685bdcecb00a3c9e","a7ddbf0dfd2c325b","ced87f2e5d5c0601","d1dc7f1a2fa6359d","e8df3e37b83f6011"],"x":1360,"y":2220,"wires":[],"l":true},{"id":"f68fea43b9c6ce7b","type":"function","z":"d9ababc8eca2aa56","name":"Fermeture des volets","func":"msg.payload =\n\n\"Fermeture des volets en cours!\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1040,"y":2220,"wires":[["10a07f1d4d2a297a"]]},{"id":"b22eb170a96127af","type":"inject","z":"d9ababc8eca2aa56","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1120,"y":2060,"wires":[["f68fea43b9c6ce7b"]]},{"id":"4bdb359d6044cacd","type":"inject","z":"d9ababc8eca2aa56","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":2100,"wires":[["fadbfaf796ea21b2"]]},{"id":"49536083564bc0b9","type":"debug","z":"d9ababc8eca2aa56","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1290,"y":2340,"wires":[]},{"id":"b5c05c5e4ed66f8e","type":"api-current-state","z":"d9ababc8eca2aa56","name":"is portail garage ouvert ?","server":"43d85569dace75e0","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.co_portail_garage_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":710,"y":780,"wires":[["25a9b3dfea3749b0"],["c96e244f7488b4aa"]]},{"id":"4c0ac7c5dd2a1591","type":"api-current-state","z":"d9ababc8eca2aa56","name":"is portail garage ferme ?","server":"43d85569dace75e0","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.co_portail_garage_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":410,"y":1120,"wires":[["2e9de0ce3e1928e8"],["26fc0810a4d91bde"]]},{"id":"c7ca5c039d5c7a21","type":"link in","z":"d9ababc8eca2aa56","name":"Alexa - Fermeture des volets","links":["ece2555b7528c6fb","f70305464d7647de"],"x":360,"y":2320,"wires":[["a9dc91d57fd0ca7d"]],"l":true},{"id":"efc5feb261c2bc3c","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":520,"wires":[["88509dc6c4592504","9b1f159c78e937b5","8d9e750f4c47084d","80b06f455f532216"]]},{"id":"84ec312a296f9a5f","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":140,"wires":[["a7d949351ca82ffc","21d92df44ce0c971"]]},{"id":"70be246c67d482d1","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":1620,"wires":[["f91445d4b4ce9fb1","12b4ca0d10f9b142"]]},{"id":"46fc52a5883edfbe","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":1980,"wires":[["91f32049608764b0","01b310e873c615f1"]]},{"id":"91f32049608764b0","type":"api-call-service","z":"d9ababc8eca2aa56","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.volet_chambre_clarence","cover.volet_chambre_parents","cover.volet_eloise","cover.volet_sdb"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1210,"y":1980,"wires":[[]]},{"id":"4ebbdfac75d6c84c","type":"switch","z":"d9ababc8eca2aa56","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":2220,"wires":[["fadbfaf796ea21b2","1813357eb1365660"]]},{"id":"4206c04e934cbce9","type":"inject","z":"d9ababc8eca2aa56","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":2400,"wires":[["a9dc91d57fd0ca7d"]]},{"id":"2427b400591a666d","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Ouverture portail garage","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.portail_garage_switch_2"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":340,"wires":[["8362ce5dc8b1dc6b"]]},{"id":"9f6a7e6480b35001","type":"api-current-state","z":"d9ababc8eca2aa56","name":"is portail garage ouvert ?","server":"43d85569dace75e0","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.co_portail_garage_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":970,"y":280,"wires":[["8362ce5dc8b1dc6b"],["2427b400591a666d"]]},{"id":"8362ce5dc8b1dc6b","type":"ha-wait-until","z":"d9ababc8eca2aa56","name":"","server":"43d85569dace75e0","version":1,"outputs":2,"entityId":"binary_sensor.ir_garage_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"1","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"data","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":1340,"y":260,"wires":[["0aaf4484283d928f"],["e61a87dfc270a312"]]},{"id":"0aaf4484283d928f","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1500,"y":220,"wires":[["e61a87dfc270a312"]]},{"id":"e61a87dfc270a312","type":"link out","z":"d9ababc8eca2aa56","name":"","mode":"link","links":["9780d18bcf46416f"],"x":1555,"y":300,"wires":[]},{"id":"a30922e8b49c0fd4","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Portail extérieur","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.portail_exterieur"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":1320,"wires":[["c8e3314aaab3742e","ddb41dd0fea55dbb"]]},{"id":"4c7e0a65ec592f5c","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Input_boolean portail entrant","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.script_portail_sortant_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":500,"y":140,"wires":[["84ec312a296f9a5f","0db865f8ba8fe917"]]},{"id":"3fc18788c18a9f98","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Turn off IB portail entrant","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.script_portail_sortant_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1170,"y":100,"wires":[[]]},{"id":"05d037e43e51d289","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Input_boolean portail sortant","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.script_portail_entrant_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":420,"y":520,"wires":[["efc5feb261c2bc3c","8d9e750f4c47084d"]]},{"id":"f39e44b794814024","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Turn off IB portail sortant","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.script_portail_entrant_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":420,"wires":[[]]},{"id":"0db865f8ba8fe917","type":"debug","z":"d9ababc8eca2aa56","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":770,"y":60,"wires":[]},{"id":"d74ca57d12d01cad","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Portail garage nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.portail_garage_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":780,"wires":[[]]},{"id":"f3321b362e6245ae","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"portail garage nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.portail_garage_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":440,"y":920,"wires":[["c96e244f7488b4aa"]]},{"id":"1151be7739ae0517","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"portail exterieur nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.portail_exterieur_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":530,"y":1320,"wires":[["a30922e8b49c0fd4"]]},{"id":"0349364015aa8f2a","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Volet Rez de chaussée","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.volets_rez_chaussee_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":780,"y":1620,"wires":[["70be246c67d482d1"]]},{"id":"ec935d457138d0ec","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Volets étage","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.volets_etages_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":1940,"wires":[["46fc52a5883edfbe"]]},{"id":"12b4ca0d10f9b142","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Volet Rez de chaussée","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.volets_rez_chaussee_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1300,"y":1540,"wires":[[]]},{"id":"01b310e873c615f1","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Volets étage","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.volets_etages_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":1920,"wires":[[]]},{"id":"7d61628cfc43f7f3","type":"server-state-changed","z":"d9ababc8eca2aa56","name":"Volets maison nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.volets_maison_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":320,"y":2220,"wires":[["4ebbdfac75d6c84c"]]},{"id":"1813357eb1365660","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Volets maison - off nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.volets_maison_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":760,"y":2180,"wires":[[]]},{"id":"ddb41dd0fea55dbb","type":"api-call-service","z":"d9ababc8eca2aa56","name":"Portail exterieur nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.portail_exterieur_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":1280,"wires":[[]]},{"id":"8d9e750f4c47084d","type":"debug","z":"d9ababc8eca2aa56","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":850,"y":660,"wires":[]},{"id":"80b06f455f532216","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":780,"y":420,"wires":[["f39e44b794814024"]]},{"id":"21d92df44ce0c971","type":"delay","z":"d9ababc8eca2aa56","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":940,"y":100,"wires":[["3fc18788c18a9f98"]]},{"id":"1ab3348390070769","type":"api-render-template","z":"c375fce693136161","name":"Prévision Méteo","server":"43d85569dace75e0","version":0,"template":"Coucou ... bulletin méteo... Une journée{% set condition =\n(states.weather.la_chevroliere.attributes.forecast[0].condition) %} {% set\nconditions = {'clear-night': 'nuit dégagée', 'cloudy': 'nuageuse',\n'exceptional': 'exceptionnelle', 'fog': ' avec broullard', 'hail': 'grêle',\n'lightning': 'Orageuse', 'lightning-rainy': 'orageuse avec de la pluie',\n'partlycloudy': 'partiellement nuageuse', 'pouring': ' avec pluie\ntorentielle', 'rainy': 'pluvieuse', 'snowy': 'avec de la neige',\n'snowy-rainy': ' avec neige et pluvieuse', 'sunny': 'ensoleillé', 'windy':\n'Venteuse', 'windy-variant': 'variante venteuse'} %} {{\nconditions[condition] }} est attendue aujourd'hui , avec une température\nmoyenne de {{state_attr('weather.la_chevroliere', 'forecast')[0].temperature\n}}°C et un minimum de {{state_attr('weather.la_chevroliere',\n'forecast')[0].templow }}°C. Demain une journée {% set condition =\n(states.weather.la_chevroliere.attributes.forecast[1].condition) %} {% set\nconditions = {'clear-night': 'nuit claire', 'cloudy': 'nuageuse',\n'exceptional': 'exceptionnelle', 'fog': ' avec broullard', 'hail': 'grêle',\n'lightning': 'Orageuse', 'lightning-rainy': 'orageuse avec de la pluie',\n'partlycloudy': 'partiellement nuageuse', 'pouring': ' avec pluie\ntorentielle', 'rainy': 'pluvieuse', 'snowy': 'avec de la neige',\n'snowy-rainy': ' avec neige et pluvieuse', 'sunny': 'ensoleillé', 'windy':\n'Venteuse', 'windy-variant': 'variante venteuse'} %} {{\nconditions[condition] }} est prévue avec une température maxi de\n{{state_attr('weather.la_chevroliere', 'forecast')[1].temperature }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":500,"y":160,"wires":[["617bac76d94e3936"]]},{"id":"617bac76d94e3936","type":"link out","z":"c375fce693136161","name":"","mode":"link","links":["9017154cf2b33cbe"],"x":655,"y":160,"wires":[]},{"id":"549940cc36b460a9","type":"cron","z":"c375fce693136161","name":"At 6:30 AM","crontab":"30 6 * * *","x":180,"y":160,"wires":[["1ab3348390070769"]]},{"id":"fa7caa2883360450","type":"comment","z":"c375fce693136161","name":"Prévision méteo","info":"","x":390,"y":100,"wires":[]},{"id":"5ed6b5d38eb561b0","type":"server-state-changed","z":"c375fce693136161","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.44_weather_alert","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payloadCouleur","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":300,"y":340,"wires":[["c2697669f5108af5"]]},{"id":"c2697669f5108af5","type":"switch","z":"c375fce693136161","name":"","property":"payloadCouleur","propertyType":"msg","rules":[{"t":"eq","v":"Jaune","vt":"str"},{"t":"eq","v":"Orange","vt":"str"},{"t":"eq","v":"Rouge","vt":"str"},{"t":"eq","v":"Vert","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":630,"y":340,"wires":[["1ce7ae990e95a6e2"],["1ce7ae990e95a6e2"],["1ce7ae990e95a6e2"],["fb85617466739913"]]},{"id":"1ce7ae990e95a6e2","type":"api-render-template","z":"c375fce693136161","name":"Message alerte méteo","server":"43d85569dace75e0","version":0,"template":"    Une alerte météo France {{states('sensor.44_weather_alert')}} est en cours sur le département:\n     {%- for attr in ['Vent violent', 'Pluie-inondation', 'Orages', 'Inondation', 'Neige-verglas', 'Canicule', 'Grand-froid', 'Avalanches', 'Vagues-submersion'] -%} {%- if state_attr('sensor.44_weather_alert', attr) != 'Vert' and state_attr('sensor.44_weather_alert', attr) != None %}\n     - {{attr}} : {{state_attr('sensor.44_weather_alert', attr)}} {%- endif -%} {% endfor -%}","resultsLocation":"payloadDescription","resultsLocationType":"msg","templateLocation":"templatetest","templateLocationType":"msg","x":900,"y":300,"wires":[["3ee00beb84e05347"]]},{"id":"52ce9b2eeac28c0a","type":"link out","z":"c375fce693136161","name":"","mode":"link","links":["9017154cf2b33cbe"],"x":1525,"y":300,"wires":[]},{"id":"fb85617466739913","type":"function","z":"c375fce693136161","name":"Fin de l'alerte","func":"msg.payload =\n\n\"Fin de l'alerte météo\" \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":360,"wires":[[]]},{"id":"069e8e73edbbd340","type":"comment","z":"c375fce693136161","name":"Prévision méteo","info":"","x":380,"y":260,"wires":[]},{"id":"2f4f2f4f9664c625","type":"inject","z":"c375fce693136161","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":100,"wires":[["1ab3348390070769"]]},{"id":"cefdbd741ccca6a9","type":"api-render-template","z":"c375fce693136161","name":"Prévision Méteo","server":"43d85569dace75e0","version":0,"template":"Coucou ... bulletin méteo... Une journée{% set condition =\n(states.weather.la_chevroliere.attributes.forecast[0].condition) %} {% set\nconditions = {'clear-night': 'nuit dégagée', 'cloudy': 'nuageuse',\n'exceptional': 'exceptionnelle', 'fog': ' avec broullard', 'hail': 'grêle',\n'lightning': 'Orageuse', 'lightning-rainy': 'orageuse avec de la pluie',\n'partlycloudy': 'partiellement nuageuse', 'pouring': ' avec pluie\ntorentielle', 'rainy': 'pluvieuse', 'snowy': 'avec de la neige',\n'snowy-rainy': ' avec neige et pluvieuse', 'sunny': 'ensoleillé', 'windy':\n'Venteuse', 'windy-variant': 'variante venteuse'} %} {{\nconditions[condition] }} est attendue aujourd'hui , avec une température\nmoyenne de {{state_attr('weather.la_chevroliere', 'forecast')[0].temperature\n}}°C et un minimum de {{state_attr('weather.la_chevroliere',\n'forecast')[0].templow }}°C. Demain une journée {% set condition =\n(states.weather.la_chevroliere.attributes.forecast[1].condition) %} {% set\nconditions = {'clear-night': 'nuit claire', 'cloudy': 'nuageuse',\n'exceptional': 'exceptionnelle', 'fog': ' avec broullard', 'hail': 'grêle',\n'lightning': 'Orageuse', 'lightning-rainy': 'orageuse avec de la pluie',\n'partlycloudy': 'partiellement nuageuse', 'pouring': ' avec pluie\ntorentielle', 'rainy': 'pluvieuse', 'snowy': 'avec de la neige',\n'snowy-rainy': ' avec neige et pluvieuse', 'sunny': 'ensoleillé', 'windy':\n'Venteuse', 'windy-variant': 'variante venteuse'} %} {{\nconditions[condition] }} est prévue avec une température maxi de\n{{state_attr('weather.la_chevroliere', 'forecast')[1].temperature }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":480,"y":580,"wires":[["50550b3226604282"]]},{"id":"50550b3226604282","type":"link out","z":"c375fce693136161","name":"","mode":"link","links":["93d062bbf9af5c89"],"x":645,"y":620,"wires":[]},{"id":"7251c6bb3c48619e","type":"comment","z":"c375fce693136161","name":"Prévision méteo","info":"","x":370,"y":520,"wires":[]},{"id":"754c951524912d4a","type":"inject","z":"c375fce693136161","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":600,"wires":[["376d94a97ba0f4bb"]]},{"id":"376d94a97ba0f4bb","type":"function","z":"c375fce693136161","name":"Fin de l'alerte","func":"msg.payload =\n\n\"Fin de l'alerte météo \" + \"😁\"\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480,"y":660,"wires":[["50550b3226604282"]]},{"id":"3169d8db7ab6335f","type":"server-state-changed","z":"c375fce693136161","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.la_chevroliere_rain_chance","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":860,"wires":[["fe116e5a6ff1c3e4"]]},{"id":"fe116e5a6ff1c3e4","type":"debug","z":"c375fce693136161","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":860,"wires":[]},{"id":"a2a98d65e3545f70","type":"server-state-changed","z":"c375fce693136161","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"weather.maison","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":310,"y":940,"wires":[[]]},{"id":"df8655d33b549bb6","type":"api-current-state","z":"c375fce693136161","name":"","server":"43d85569dace75e0","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.44_weather_alert","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payloadCouleur","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":310,"y":420,"wires":[["2b8c35ae07c60408"]]},{"id":"2b8c35ae07c60408","type":"debug","z":"c375fce693136161","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":590,"y":420,"wires":[]},{"id":"3ad025a9499394c3","type":"inject","z":"c375fce693136161","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":480,"wires":[["df8655d33b549bb6"]]},{"id":"3ee00beb84e05347","type":"api-render-template","z":"c375fce693136161","name":"Format date et heure","server":"43d85569dace75e0","version":0,"template":"{{ now().timestamp() | timestamp_custom('%Y-%m-%d %H:%M:%S', true)}}","resultsLocation":"payloadStart","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":960,"y":200,"wires":[["138272aea495f0aa"]]},{"id":"24d41476343c722d","type":"function","z":"c375fce693136161","name":"","func":"var meteoCouleur = msg.data.new_state.state\n\nif(meteoCouleur == \"Jaune\")\n{\n    TextMeteoColor = \"Soyez attentifs. Si vous pratiquez des activités sensibles au risque météorologique ou exposées aux crues\"\n}\n\nif(meteoCouleur == \"Orange\")\n{\n    TextMeteoColor = \"Soyez très vigilant. Des phénomènes dangereux sont prévus.\"\n}\n\nif(meteoCouleur == \"Rouge\")\n{\n    TextMeteoColor = \"Une vigilance absolue s'impose. Des phénomènes dangereux d'intensité exceptionnelle sont prévus.\"\n}\n\n\n\n\nmsg.payload = \n{\n    \"service\":\"add_event\",\n    data:\n    {  \"calendar_id\": \"90kmsfbmhueurlhf74e6od3rc8@group.calendar.google.com\",\n    \"summary\": \"Alerte méteo France: \"+ msg.data.new_state.state,\n    \"description\": msg.payloadDescription,\n    \"start_date_time\": msg.payloadStart,\n    \"end_date_time\": msg.payloadStart,\n}\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":200,"wires":[["b3cd5618a7693112"]]},{"id":"b3cd5618a7693112","type":"api-call-service","z":"c375fce693136161","name":"Add méteo event google","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"google","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1590,"y":200,"wires":[[]]},{"id":"138272aea495f0aa","type":"api-render-template","z":"c375fce693136161","name":"Couleur météo","server":"43d85569dace75e0","version":0,"template":"Alerte météo - {{states('sensor.44_weather_alert')}}","resultsLocation":"payloadCouleur","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1180,"y":200,"wires":[["24d41476343c722d","69f8c82156a926ba"]]},{"id":"5fe17cc7bfbe78b4","type":"api-render-template","z":"c375fce693136161","name":"Couleur météo","server":"43d85569dace75e0","version":0,"template":"{{states('sensor.44_weather_alert')}}","resultsLocation":"payloadCouleur","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1100,"y":100,"wires":[[]]},{"id":"6cd6aac0635b3abf","type":"inject","z":"c375fce693136161","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":900,"y":100,"wires":[["5fe17cc7bfbe78b4"]]},{"id":"ef118ce3497dddbf","type":"debug","z":"c375fce693136161","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":400,"wires":[]},{"id":"69f8c82156a926ba","type":"function","z":"c375fce693136161","name":"","func":"var meteoCouleur = msg.data.new_state.state;\n\nif(meteoCouleur == \"Jaune\")\n{\n    textMeteoColor = \" SOYEZ ATTENTIF. Si vous pratiquez des activités sensibles au risque météorologique ou exposées aux crues\"\n}\n\nif(meteoCouleur == \"Orange\")\n{\n    textMeteoColor = \" SOYEZ TRES VIGILANT. Des phénomènes dangereux sont prévus.\"\n}\n\nif(meteoCouleur == \"Rouge\")\n{\n    textMeteoColor = \" UNE VILANCE ANSOLUE S'IMPOSE. Des phénomènes dangereux d'intensité exceptionnelle sont prévus.\"\n}\n\n\n\n\nmsg.payload = msg.payloadDescription + \".   \" + textMeteoColor\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":300,"wires":[["52ce9b2eeac28c0a","ef118ce3497dddbf"]]},{"id":"f675e9223eab38a4","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.myups_status_data","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":400,"wires":[["b1f17329ce9f5fa9","5726c0d3f5a00184"]]},{"id":"56811617225d77bb","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nas_netgear","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":260,"wires":[["55ff6fd3205be22b"]]},{"id":"a15f2aab9e2ee711","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nas_nl54","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":200,"wires":[["55ff6fd3205be22b"]]},{"id":"55ff6fd3205be22b","type":"or-gate","z":"d7f40c000c1a05ef","name":"","rules":[{"t":"eq","v":"on","vt":"str","propertyType":"msg","property":"payload","topic":"switch.nas_nl54"},{"t":"eq","v":"on","vt":"str","propertyType":"msg","property":"payload","topic":"switch.nas_netgear"}],"outputTopic":"OrGate","gateType":"or","emitOnlyIfTrue":false,"x":440,"y":220,"wires":[["b1f17329ce9f5fa9","6c4e885d50c8a89a"]]},{"id":"6c4e885d50c8a89a","type":"debug","z":"d7f40c000c1a05ef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":100,"wires":[]},{"id":"b1f17329ce9f5fa9","type":"and-gate","z":"d7f40c000c1a05ef","name":"","rules":[{"t":"eq","v":"OB","vt":"str","propertyType":"msg","property":"payload","topic":"sensor.myups_status_data"},{"t":"true","propertyType":"msg","property":"bool","topic":"OrGate"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":true,"x":600,"y":320,"wires":[["dd1473af64385848","ae4f3f8ef604e282"]]},{"id":"1ac313adc77c3f51","type":"link out","z":"d7f40c000c1a05ef","name":"Vers Pascal Telegram SMS","mode":"link","links":["93d062bbf9af5c89","a7ddbf0dfd2c325b"],"x":2100,"y":140,"wires":[],"l":true},{"id":"0a26de175c3c9fc4","type":"comment","z":"d7f40c000c1a05ef","name":"Auto OFF des NAS en cas de panne","info":"","x":310,"y":80,"wires":[]},{"id":"ec9d3a1c1dc839bf","type":"comment","z":"d7f40c000c1a05ef","name":"Notification - NAS-NETGEAR ou TRUENAS - ON","info":"Notifier quand NAS-NETGEAR OU TRUENAS est ON après une commande Alexa","x":180,"y":720,"wires":[]},{"id":"2698cd3d153c15d0","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nas_netgear","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"1","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":820,"wires":[["1f7bcca1778322a3"]]},{"id":"bc10b2d959762d32","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.nas_nl54","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"1","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":920,"wires":[["eca2daab358c838c"]]},{"id":"7352a58f1f38b85b","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["57aaf9213ca5863b"],"x":940,"y":920,"wires":[],"l":true},{"id":"a19c71284c7f7a3e","type":"api-call-service","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.nas_nl54"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":1120,"wires":[[]]},{"id":"9b9464e6ae9560e7","type":"comment","z":"d7f40c000c1a05ef","name":"Auto On NAS NL54L","info":"","x":90,"y":1040,"wires":[]},{"id":"b5b6a03e6bb5fa7d","type":"comment","z":"d7f40c000c1a05ef","name":"Alert on Power IT OFF","info":"","x":100,"y":1280,"wires":[]},{"id":"f727d7af885e1fd8","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"Surveillance état prise informatique","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.prise_serveurs","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":1420,"wires":[["bed8c3824713a1ea","31cf549a0ff48806","1cb584a50d7b1f32"],["6f4fa34cc44e27bf"]]},{"id":"60e510e75983967b","type":"link out","z":"d7f40c000c1a05ef","name":"","mode":"link","links":["9017154cf2b33cbe","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":935,"y":1320,"wires":[]},{"id":"bed8c3824713a1ea","type":"function","z":"d7f40c000c1a05ef","name":"Notification -  prise informatique","func":"msg.payload =\n\n\"Attention: Prise informatique a été éteinte\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":1340,"wires":[["60e510e75983967b","31cf549a0ff48806"]]},{"id":"31cf549a0ff48806","type":"debug","z":"d7f40c000c1a05ef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1290,"y":1400,"wires":[]},{"id":"1cb584a50d7b1f32","type":"delay","z":"d7f40c000c1a05ef","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":540,"y":1260,"wires":[["61e20780471949b6"]]},{"id":"61e20780471949b6","type":"api-call-service","z":"d7f40c000c1a05ef","name":"Prise informatique","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.prise_serveurs"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":750,"y":1260,"wires":[[]]},{"id":"3ee7e5921b77d5cf","type":"link out","z":"d7f40c000c1a05ef","name":"","mode":"link","links":["22186f7a74fec36f","93d062bbf9af5c89","a7ddbf0dfd2c325b","f550e12c1257457e"],"x":895,"y":1460,"wires":[]},{"id":"6f4fa34cc44e27bf","type":"function","z":"d7f40c000c1a05ef","name":"Notification - Reprise prise informatique","func":"msg.payload =\n\n\"Attention: Prise informatique remise sur l'état ON \"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":1460,"wires":[["3ee7e5921b77d5cf"]]},{"id":"0a0c426b7264453a","type":"api-call-service","z":"d7f40c000c1a05ef","name":"mosquitto","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"addon_restart","areaId":[],"deviceId":[],"entityId":[],"data":"{\"addon\":\"core_mosquitto\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":680,"y":2220,"wires":[["1b071af5487bece2"]]},{"id":"5613345d609e1ae3","type":"function","z":"d7f40c000c1a05ef","name":"Notification - Restart de HA","func":"msg.payload =\n\n\"Rédemmarrage de Home Assistant\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":2040,"wires":[["f8c209f18a292223"]]},{"id":"f8c209f18a292223","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["a7ddbf0dfd2c325b"],"x":1560,"y":2040,"wires":[],"l":true},{"id":"1b071af5487bece2","type":"function","z":"d7f40c000c1a05ef","name":"Notification - Restart mosquitto","func":"msg.payload =\n\n\"Restart de mosquitto\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":2220,"wires":[["a18a50a53585deab","a4b7b165afb9c1ff"]]},{"id":"a18a50a53585deab","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["a7ddbf0dfd2c325b"],"x":1250,"y":2220,"wires":[],"l":true},{"id":"03fd8ab81f48ecab","type":"api-call-service","z":"d7f40c000c1a05ef","name":"zwave","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"addon_restart","areaId":[],"deviceId":[],"entityId":[],"data":"{\"addon\":\"a0d7b954_zwavejs2mqtt\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":730,"y":2440,"wires":[["8acae18ce7ef5afe","a50b214cc5b100e5"]]},{"id":"8acae18ce7ef5afe","type":"function","z":"d7f40c000c1a05ef","name":"Notification - Restart zwaveJS","func":"msg.payload =\n\n\"Restart de mosquitto\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":2440,"wires":[["95326c2d3f13d1e5"]]},{"id":"95326c2d3f13d1e5","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["a7ddbf0dfd2c325b"],"x":1200,"y":2440,"wires":[],"l":true},{"id":"08ac8080791d8ba6","type":"cron","z":"d7f40c000c1a05ef","name":"At  12:30 PM","crontab":"30 12 * * *","x":310,"y":1120,"wires":[["a19c71284c7f7a3e"]]},{"id":"d453b311c507c823","type":"comment","z":"d7f40c000c1a05ef","name":"Reboot HA","info":"","x":60,"y":2000,"wires":[]},{"id":"b43acda4e0fdfdfb","type":"cron","z":"d7f40c000c1a05ef","name":"At 1:15 AM","crontab":"15 1 * * *","x":540,"y":2160,"wires":[["0a0c426b7264453a"]]},{"id":"504048ebb5ce4b7a","type":"cron","z":"d7f40c000c1a05ef","name":"At 1:20 AM","crontab":"20 1 * * *","x":380,"y":2380,"wires":[[]]},{"id":"76403037e08490c6","type":"comment","z":"d7f40c000c1a05ef","name":"Reboot Mosquitto","info":"","x":80,"y":2140,"wires":[]},{"id":"915a6bb711bd4eeb","type":"comment","z":"d7f40c000c1a05ef","name":"Reboot Zwave JS","info":"","x":80,"y":2380,"wires":[]},{"id":"ba5648337b0bbccc","type":"comment","z":"d7f40c000c1a05ef","name":"Module zigbee","info":"","x":80,"y":2580,"wires":[]},{"id":"d90efcbce9cd1061","type":"api-call-service","z":"d7f40c000c1a05ef","name":"zigbee","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"addon_restart","areaId":[],"deviceId":[],"entityId":[],"data":"{\"addon\":\"45df7312-zigbee2mqtt\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":750,"y":2680,"wires":[["a2a32a464371d4dd","bd1c9e8807684e94"]]},{"id":"e6a650a7b559b2b6","type":"api-call-service","z":"d7f40c000c1a05ef","name":"zigbee","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"addon_restart","areaId":[],"deviceId":[],"entityId":[],"data":"{\"addon\":\"45df7312-zigbee2mqtt\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":730,"y":2840,"wires":[["3f9ff56ae09459f0","d2141d683f0c0e8a","373e7ef9d4fbde7a"]]},{"id":"b1149156dd2b86ad","type":"api-call-service","z":"d7f40c000c1a05ef","name":"mosquitto","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"addon_restart","areaId":[],"deviceId":[],"entityId":[],"data":"{\"addon\":\"core_mosquitto\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":2840,"wires":[[]]},{"id":"634dcb2340fe65fa","type":"api-call-service","z":"d7f40c000c1a05ef","name":"zwave","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"addon_restart","areaId":[],"deviceId":[],"entityId":[],"data":"{\"addon\":\"a0d7b954_zwavejs2mqtt\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1110,"y":2840,"wires":[["a5528a5de438bd67"]]},{"id":"3f9ff56ae09459f0","type":"delay","z":"d7f40c000c1a05ef","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":920,"y":2840,"wires":[["634dcb2340fe65fa"]]},{"id":"a5528a5de438bd67","type":"delay","z":"d7f40c000c1a05ef","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1300,"y":2840,"wires":[["b1149156dd2b86ad"]]},{"id":"44ba8fb5fdcd656b","type":"comment","z":"d7f40c000c1a05ef","name":"Modules domotique","info":"","x":90,"y":2780,"wires":[]},{"id":"4e6dc86e8b91ea14","type":"function","z":"d7f40c000c1a05ef","name":"","func":"if (msg.payload === \"on\")\nmsg.payload = \n{\n    \"service\":\"host_reboot\",\n\n  \n};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":2040,"wires":[["202d8be8b095a91a","3eb96014121fbd87","931f57ea4b7cfa67"]]},{"id":"202d8be8b095a91a","type":"debug","z":"d7f40c000c1a05ef","name":"","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":2080,"wires":[]},{"id":"3eb96014121fbd87","type":"api-call-service","z":"d7f40c000c1a05ef","name":"Reboot HA","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"hassio","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":2040,"wires":[["5613345d609e1ae3"]]},{"id":"575dd0266f562c45","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"modules domotique","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.modules_domotique_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":530,"y":2840,"wires":[["e6a650a7b559b2b6"]]},{"id":"ffdca5cb35f809dc","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"Mosquitto nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.module_mosquitto_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":450,"y":2220,"wires":[["0a0c426b7264453a"]]},{"id":"c2ef787bf27c5655","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"Home assistant nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.module_home_assistant_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":470,"y":2040,"wires":[["4e6dc86e8b91ea14"]]},{"id":"931f57ea4b7cfa67","type":"api-call-service","z":"d7f40c000c1a05ef","name":"Home Assistant nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.module_home_assistant_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":950,"y":1960,"wires":[[]]},{"id":"a4b7b165afb9c1ff","type":"api-call-service","z":"d7f40c000c1a05ef","name":"Mosquitto nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.module_mosquitto_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1230,"y":2140,"wires":[[]]},{"id":"f9a2832a3f1e4d8c","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"zwave nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.module_zwave_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":500,"y":2440,"wires":[["03fd8ab81f48ecab"]]},{"id":"0b3df2707277db4d","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"zigbee nd","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.module_zigbee_nd","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":540,"y":2680,"wires":[["d90efcbce9cd1061"]]},{"id":"a2a32a464371d4dd","type":"function","z":"d7f40c000c1a05ef","name":"Notification - Restart zigbee","func":"msg.payload =\n\n\"Restart de zigbee\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":2680,"wires":[["941a27dd0d638719"]]},{"id":"941a27dd0d638719","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["a7ddbf0dfd2c325b"],"x":1220,"y":2680,"wires":[],"l":true},{"id":"bd1c9e8807684e94","type":"api-call-service","z":"d7f40c000c1a05ef","name":"zigbee nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.module_zigbee_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":2580,"wires":[[]]},{"id":"d2141d683f0c0e8a","type":"function","z":"d7f40c000c1a05ef","name":"Notification - Restart domotique","func":"msg.payload =\n\n\"Redémarrage des modules domotique\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":2780,"wires":[["7ecfa2c03fcf16a9"]]},{"id":"7ecfa2c03fcf16a9","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["a7ddbf0dfd2c325b"],"x":1220,"y":2780,"wires":[],"l":true},{"id":"a50b214cc5b100e5","type":"api-call-service","z":"d7f40c000c1a05ef","name":"zwave nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.module_zwave_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":900,"y":2360,"wires":[[]]},{"id":"373e7ef9d4fbde7a","type":"api-call-service","z":"d7f40c000c1a05ef","name":"Domotique nd","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.modules_domotique_nd"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":2920,"wires":[[]]},{"id":"ae7eca88dcf72ba4","type":"debug","z":"d7f40c000c1a05ef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":240,"wires":[]},{"id":"dd1473af64385848","type":"api-current-state","z":"d7f40c000c1a05ef","name":"NL54L","server":"43d85569dace75e0","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.nas_nl54","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payloadnl54l","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":790,"y":260,"wires":[["6907e57b728c37f3"]]},{"id":"ae4f3f8ef604e282","type":"api-current-state","z":"d7f40c000c1a05ef","name":"Netgear","server":"43d85569dace75e0","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.nas_netgear","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payloadNetgear","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":800,"y":380,"wires":[["4b3bfe210a73fca1"]]},{"id":"6907e57b728c37f3","type":"switch","z":"d7f40c000c1a05ef","name":"","property":"payloadnl54l","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":260,"wires":[["385d49f13ad04a46"]]},{"id":"4b3bfe210a73fca1","type":"switch","z":"d7f40c000c1a05ef","name":"","property":"payloadNetgear","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":380,"wires":[["ed53ece93bb33228"]]},{"id":"385d49f13ad04a46","type":"api-call-service","z":"d7f40c000c1a05ef","name":"NL54L OFF","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.nas_nl54"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1210,"y":260,"wires":[[]]},{"id":"ed53ece93bb33228","type":"api-call-service","z":"d7f40c000c1a05ef","name":"NL54L OFF","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.nas_netgear"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1210,"y":380,"wires":[[]]},{"id":"164a1b35e1b3db92","type":"switch","z":"d7f40c000c1a05ef","name":"","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"eq","v":"OL","vt":"str"},{"t":"eq","v":"OB","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1470,"y":140,"wires":[["bf95a7dc7490ae4b","ae7eca88dcf72ba4"],["eb6caa1dad3fb3ed"]]},{"id":"bf95a7dc7490ae4b","type":"function","z":"d7f40c000c1a05ef","name":"Coupure électrique détectée","func":"msg.payload =\n    \n    \"Panne électrique détectée - extinction des NAS!! \" +\n    \" Nouveau statut: \" + msg.data.new_state.state\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1740,"y":120,"wires":[["1ac313adc77c3f51"]]},{"id":"eb6caa1dad3fb3ed","type":"function","z":"d7f40c000c1a05ef","name":"Coupure électrique détectée","func":"msg.payload =\n    \n    \"Reprise de l'alimentation éléctrique détectée!! \" +\n    \" Nouveau statut: \" + msg.data.new_state.state\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1740,"y":180,"wires":[["1ac313adc77c3f51"]]},{"id":"eca2daab358c838c","type":"function","z":"d7f40c000c1a05ef","name":"","func":"if (msg.payload === \"on\")\nmsg.payload =  \"Le serveur de fichier NL54L est en marche\"\n    \nif (msg.payload === \"off\")\nmsg.payload =  \"Le serveur de fichier NL54L est arrêté\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":920,"wires":[["7352a58f1f38b85b"]]},{"id":"27d3f89a682c1c48","type":"link out","z":"d7f40c000c1a05ef","name":"VersTelegram","mode":"link","links":["57aaf9213ca5863b"],"x":940,"y":820,"wires":[],"l":true},{"id":"1f7bcca1778322a3","type":"function","z":"d7f40c000c1a05ef","name":"","func":"if (msg.payload === \"on\")\nmsg.payload =  \"Le serveur de fichier Netgear est en marche\"\n    \nif (msg.payload === \"off\")\nmsg.payload =  \"Le serveur de fichier Netgear est arrêté\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":820,"wires":[["27d3f89a682c1c48"]]},{"id":"6bf394ca3e9a3148","type":"cron","z":"d7f40c000c1a05ef","name":"At  16:30 PM","crontab":"30 16 * * *","x":890,"y":1120,"wires":[["767276ff66657e72"]]},{"id":"767276ff66657e72","type":"api-call-service","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.nas_nl54"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1120,"y":1120,"wires":[[]]},{"id":"9d0932b421962d3f","type":"link in","z":"d7f40c000c1a05ef","name":"Auto OFF des NAS en cas de panne - IN","links":["5726c0d3f5a00184"],"x":1345,"y":100,"wires":[["164a1b35e1b3db92"]]},{"id":"1379d1b3485ed752","type":"link out","z":"d7f40c000c1a05ef","name":"","mode":"link","links":[],"x":115,"y":1060,"wires":[]},{"id":"5726c0d3f5a00184","type":"link out","z":"d7f40c000c1a05ef","name":"Auto OFF des NAS en cas de panne - OUT","mode":"link","links":["19a0a665f63b1f3b","9d0932b421962d3f"],"x":575,"y":400,"wires":[]},{"id":"fb88213155216946","type":"server-state-changed","z":"d7f40c000c1a05ef","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.myups_battery_charge","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":500,"wires":[[]]},{"id":"a1472599be09f39e","type":"function","z":"d7f40c000c1a05ef","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":500,"wires":[[]]},{"id":"bf394d5a.9fd29","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":380,"wires":[]},{"id":"b599d42c.8ecc7","type":"function","z":"b6bf4fb2.8e8618","name":"Structure payload","func":"function isNumeric(n) { \n      return !isNaN(parseFloat(n)) && isFinite(n); \n}\n\n// Pour tous les labels \nfor (var label in msg.payload ) {\n    var value = msg.payload[label];\n    \n\t// Correction des valeurs type string en numérique \t\t\n\tif (label == \"OPTARIF\")\t{\n  \t\t// L'option tarifaire choisie (Groupe \"OPTARIF\") est codée sur 4 caractères alphanumériques \n  \t\t// J'ai pris un nombre arbitraire codé dans l'ordre ci-dessous \n  \t\t// je mets le 4eme char à 0, trop de possibilités \n      \tvalue = value.substring(0, 3);\n    \n       \tif      (value==\"BAS\") value=1;// BASE => Option Base. \n  \t\telse if (value==\"HC.\") value=2;// HC.. => Option Heures Creuses. \n  \t\telse if (value==\"EJP\") value=3;// EJP. => Option EJP. \n  \t\telse if (value==\"BBR\") value=4;// BBRx => Option Tempo\n  \t\telse value = 0;\n  \t\t\n  \t\tmsg.payload[label] = value;\n\t} else if (label==\"HHPHC\") {\n      // L'horaire heures pleines/heures creuses (Groupe \"HHPHC\") est codé par un caractère A à Y \n      // J'ai choisi de prendre son code ASCII\n      msg.payload[label] = value.charCodeAt();\n    } else if ( label == \"PTEC\") {\n      // La période tarifaire en cours (Groupe \"PTEC\"), est codée sur 4 caractères \n      // J'ai pris un nombre arbitraire codé dans l'ordre ci-dessous\n      if      (value==\"TH..\") value= 1; // Toutes les Heures. \n      else if (value==\"HC..\") value= \"Heures Creuses\"; // Heures Creuses. \n      else if (value==\"HP..\") value= \"Heures Pleines\"; // Heures Pleines. \n      else if (value==\"HN..\") value= 4; // Heures Normales. \n      else if (value==\"PM..\") value= 5; // Heures de Pointe Mobile. \n      else if (value==\"HCJB\") value= 6; // Heures Creuses Jours Bleus. \n      else if (value==\"HCJW\") value= 7; // Heures Creuses Jours Blancs (White). \n      else if (value==\"HCJR\") value= 8; // Heures Creuses Jours Rouges. \n      else if (value==\"HPJB\") value= 9; // Heures Pleines Jours Bleus. \n      else if (value==\"HPJW\") value= 10;// Heures Pleines Jours Blancs (White). \n      else if (value==\"HPJR\") value= 11;// Heures Pleines Jours Rouges. \n      else value = 0;\n      \n      msg.payload[label] = value;\n    } else if ( label == \"IINST\") {\n        delete msg.payload.IINST;\n        msg.payload.IINST = Number(value)\n    } else if ( label == \"IMAX\") {\n        delete msg.payload.IMAX;\n        msg.payload.IMAX1 = Number(value);\n    } else if ( isNumeric(value) && label != \"ADCO\" ) {\n        // Transformer les valeurs numériques\n        msg.payload[label] = Number(value);\n    }\n}\n\n// Sauvegarde dans le contexte global\ncontext.global.teleinfo = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":400,"wires":[["38966188.3838be","17473b62.0be655","5203f231.a9309c","f8b9a9d0.28a1d8","58790411.399b94","bc2cf4c3.18dc9","cf3f5ea2.318c38"]]},{"id":"e6ae1666.7e85e","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"edf/index_wh","topic":"edf/index_wh","qos":"","retain":"true","broker":"580338f6.25a79","x":1310,"y":420,"wires":[]},{"id":"2b6d68ce.c4a64","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"edf/index_kwh","topic":"edf/index_kwh","qos":"","retain":"true","broker":"580338f6.25a79","x":1320,"y":520,"wires":[]},{"id":"57a56df7.4661d4","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"edf/iinst","topic":"edf/iinst","qos":"","retain":"true","broker":"580338f6.25a79","x":1300,"y":620,"wires":[]},{"id":"9229bd29.ca27b8","type":"serial in","z":"b6bf4fb2.8e8618","name":"","serial":"29cc3035.d7f7","x":70,"y":400,"wires":[["7c005dc3.81bf24"]]},{"id":"38966188.3838be","type":"function","z":"b6bf4fb2.8e8618","name":"INDEX TOTAL WH","func":"var INDEX = msg.payload.HCHC + msg.payload.HCHP\n\nmsg.payload = INDEX\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":400,"wires":[["71022c13.706b44"]]},{"id":"700dcde7.3c3524","type":"function","z":"b6bf4fb2.8e8618","name":"valide trame","func":"// La trame complète est reçue dans 'msg'\nvar teleinfo={};\n\n// Enlever les codes début et fin de trame et récupérer les lignes 1 à 1\nvar lines = msg.payload.toString().replace(\"\\u0002\\n\",\"\").replace(\"\\r\\u0003\",\"\");\nlines = lines.split(\"\\r\\n\");\n\n// Pour chaque ligne\nfor (var line in lines) {\n\tvar i;\n  \tvar checksum = 32;\n  \t\n  \t// Recupérer le label, la valeur et la checksum\n  \t// si la checksum est un espace on le remplace par un caractère non \n  \t// autorisé en checksum (ici 's') pour eviter pb de split\n  \t// donc espace espace devient espace s\n\tvar myline = lines[line].toString().replace(\"  \",\" s\").split(\" \");\n\t\n\t// on dépile nos 3 valeurs\n\tvar check = myline.pop();\n\tvar value = myline.pop();\n\tvar label = myline.pop();\n\t\n\t// On peu repositionner la checksum à espace si c'était le cas\n\tif (check == \"s\") check = \" \";\n\n\t// Calcul de la checksum sur ce qu'on a reçu, on balaye tous les caractères\t\t\n  \tfor (i = 0; i < label.length; i++) checksum += label.charCodeAt(i);\n  \tfor (i = 0; i < value.length; i++) checksum += value.charCodeAt(i);\n \tchecksum = ((checksum%256) & 63) + 32;\n \tchecksum = String.fromCharCode(checksum);\n\t\n\t// Checksum correcte ?\n \tif (checksum == check ) {\n\t\tteleinfo[label] = value;\n\t} else {\n\t\tconsole.log(\"'%s' '%s' '%s' => Bad Checksum '%s'\", label, value, check, checksum );\n\t}\n}\nreturn [ { payload: teleinfo } ];","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":400,"wires":[["b599d42c.8ecc7","a34454a0.f9e508"]]},{"id":"71022c13.706b44","type":"rbe","z":"b6bf4fb2.8e8618","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1110,"y":400,"wires":[["bf394d5a.9fd29","e6ae1666.7e85e"]]},{"id":"17473b62.0be655","type":"function","z":"b6bf4fb2.8e8618","name":"INDEX TOTAL KWH","func":"var INDEX = msg.payload.HCHC + msg.payload.HCHP\n\nmsg.payload = INDEX / 1000\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":460,"wires":[["8bcf3845.76c17"]]},{"id":"8bcf3845.76c17","type":"rbe","z":"b6bf4fb2.8e8618","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1110,"y":460,"wires":[["2427788b.79c72","2b6d68ce.c4a64"]]},{"id":"2427788b.79c72","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":480,"wires":[]},{"id":"bc2cf4c3.18dc9","type":"function","z":"b6bf4fb2.8e8618","name":"IINST","func":"var IINST = msg.payload.IINST\n\nmsg.payload = IINST\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":520,"wires":[["c06a8f31.0565d"]]},{"id":"dd6250c4.56d518","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1290,"y":580,"wires":[]},{"id":"c06a8f31.0565d","type":"rbe","z":"b6bf4fb2.8e8618","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1110,"y":520,"wires":[["dd6250c4.56d518","57a56df7.4661d4"]]},{"id":"7c005dc3.81bf24","type":"delay","z":"b6bf4fb2.8e8618","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"outputs":1,"x":260,"y":400,"wires":[["700dcde7.3c3524","420cccfd.18dbfc"]]},{"id":"5203f231.a9309c","type":"function","z":"b6bf4fb2.8e8618","name":"INDEX HC KWH","func":"var INDEX = msg.payload.HCHC\n\nmsg.payload = INDEX / 1000\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":340,"wires":[["b042d1e6.2264e"]]},{"id":"f8b9a9d0.28a1d8","type":"function","z":"b6bf4fb2.8e8618","name":"INDEX HP KWH","func":"var INDEX = msg.payload.HCHP\n\nmsg.payload = INDEX / 1000\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":280,"wires":[["3adb384.0d426c8","9cca2954.3e65e"]]},{"id":"9cca2954.3e65e","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1290,"y":180,"wires":[]},{"id":"7a3dcfd0.a80b8","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"edf/index_hp_kwh","topic":"edf/index_hp_kwh","qos":"","retain":"true","broker":"580338f6.25a79","x":1330,"y":220,"wires":[]},{"id":"2a2f87fa.cb4dc8","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1290,"y":280,"wires":[]},{"id":"dac4e55d.f70d18","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"edf/index_hc_wh","topic":"edf/index_hc_kwh","qos":"","retain":"true","broker":"580338f6.25a79","x":1330,"y":320,"wires":[]},{"id":"b042d1e6.2264e","type":"rbe","z":"b6bf4fb2.8e8618","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1110,"y":340,"wires":[["dac4e55d.f70d18","2a2f87fa.cb4dc8"]]},{"id":"3adb384.0d426c8","type":"rbe","z":"b6bf4fb2.8e8618","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1110,"y":280,"wires":[["7a3dcfd0.a80b8","9cca2954.3e65e"]]},{"id":"58790411.399b94","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":300,"wires":[]},{"id":"a34454a0.f9e508","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":300,"wires":[]},{"id":"420cccfd.18dbfc","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":270,"y":300,"wires":[]},{"id":"cf3f5ea2.318c38","type":"function","z":"b6bf4fb2.8e8618","name":"PTEC","func":"var PTEC = msg.payload.PTEC\n\nmsg.payload = PTEC\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":580,"wires":[["aed6ada5.e41f18"]]},{"id":"d71fee6.969b89","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"edf/ptec","topic":"edf/ptec","qos":"","retain":"true","broker":"580338f6.25a79","x":1300,"y":720,"wires":[]},{"id":"f395beb.f5510c","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":680,"wires":[]},{"id":"aed6ada5.e41f18","type":"rbe","z":"b6bf4fb2.8e8618","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1110,"y":580,"wires":[["f395beb.f5510c","d71fee6.969b89"]]},{"id":"811b264f307fb7d4","type":"api-get-history","z":"b6bf4fb2.8e8618","name":"index edf -2mn","server":"43d85569dace75e0","version":0,"startdate":"","enddate":"","entityid":"sensor.index_edf_wh","entityidtype":"is","useRelativeTime":true,"relativeTime":"2m","flatten":true,"output_type":"array","output_location_type":"msg","output_location":"payload","x":300,"y":900,"wires":[["3f3a68f47a1aadbf"]]},{"id":"2c3f43e00e95e350","type":"api-current-state","z":"b6bf4fb2.8e8618","name":"index edf now","server":"43d85569dace75e0","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.index_edf_wh","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":300,"y":1000,"wires":[["09f0d627d575eabc"]]},{"id":"3f3a68f47a1aadbf","type":"function","z":"b6bf4fb2.8e8618","name":"","func":"msg2 = {};\nmsg2.payload = {};\ntopic = 'old';\nmsg2.payload.old_state = parseFloat(msg.payload[0].state);\nmsg2.payload.old_date = Date.parse(msg.payload[0].last_changed)/1000|0;\nmsg2.topic = topic;\nreturn msg2;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":900,"wires":[["950c8551347465ab","0b18bb78d6fe9abc"]]},{"id":"950c8551347465ab","type":"join","z":"b6bf4fb2.8e8618","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":610,"y":940,"wires":[["32eb147a26665ab0"]]},{"id":"32eb147a26665ab0","type":"function","z":"b6bf4fb2.8e8618","name":"","func":"old = msg.payload.old.old_state;\ncurrent = msg.payload.new.new_state;\ndiff_index = current - old;\ndiff_seconds = msg.payload.new.new_date - msg.payload.old.old_date;\ncoeff = diff_seconds / 3600\nconso = diff_index / coeff\nconso = Math.round(conso*100)/100\nmsg2 = {};\nmsg2.payload = {};\nmsg2.payload.conso = conso;\nreturn msg2;","outputs":1,"noerr":0,"x":790,"y":940,"wires":[["ef52dbc350e18837"]]},{"id":"4cbf334cd0850966","type":"inject","z":"b6bf4fb2.8e8618","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"120","crontab":"","once":true,"onceDelay":"30","topic":"","payload":"","payloadType":"date","x":130,"y":960,"wires":[["811b264f307fb7d4","2c3f43e00e95e350"]]},{"id":"09f0d627d575eabc","type":"function","z":"b6bf4fb2.8e8618","name":"","func":"msg3 = {};\nmsg3.payload = {};\ntopic = 'new';\nmsg3.payload.new_state = parseFloat(msg.payload);\nmsg3.payload.new_date = Date.parse(msg.data.last_changed)/1000|0;\nmsg3.topic = topic;\nreturn msg3;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1000,"wires":[["950c8551347465ab","0ae5e28d8e1c5a8d"]]},{"id":"ef88924c5060a56e","type":"mqtt out","z":"b6bf4fb2.8e8618","name":"puissance instantanée","topic":"edf/puissance_inst","qos":"","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"580338f6.25a79","x":1300,"y":940,"wires":[]},{"id":"ef52dbc350e18837","type":"function","z":"b6bf4fb2.8e8618","name":"transforme en nombre","func":"\nmsg.payload= parseFloat(msg.payload.conso);\n\nreturn msg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":940,"wires":[["ef88924c5060a56e"]]},{"id":"0b18bb78d6fe9abc","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":605,"y":855,"wires":[]},{"id":"0ae5e28d8e1c5a8d","type":"debug","z":"b6bf4fb2.8e8618","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":1020,"wires":[]},{"id":"ce6e3cf98c798e3d","type":"function","z":"b7a3c194e014f96d","name":"","func":"if (msg.payload === true)\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n   \n};\nif (msg.payload === false) msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1060,"y":460,"wires":[[]]},{"id":"2ed86f5cfa7f0354","type":"comment","z":"b7a3c194e014f96d","name":"Prise Bureau Éloïse","info":"","x":90,"y":180,"wires":[],"icon":"node-red-contrib-home-assistant-websocket/ha-entity-switch.svg"},{"id":"0ff4f5f130676ed0","type":"light-scheduler","z":"b7a3c194e014f96d","settings":"a5f60f435cd422f8","events":"[{\"start\":{\"dow\":4,\"mod\":450},\"end\":{\"dow\":4,\"mod\":1410}},{\"start\":{\"dow\":5,\"mod\":450},\"end\":{\"dow\":5,\"mod\":1410}},{\"start\":{\"dow\":2,\"mod\":450},\"end\":{\"dow\":2,\"mod\":1405}},{\"start\":{\"dow\":1,\"mod\":450},\"end\":{\"dow\":1,\"mod\":1405}},{\"start\":{\"dow\":6,\"mod\":450},\"end\":{\"dow\":6,\"mod\":1410}},{\"start\":{\"dow\":0,\"mod\":450},\"end\":{\"dow\":0,\"mod\":1410}},{\"start\":{\"dow\":3,\"mod\":450},\"end\":{\"dow\":3,\"mod\":1405}}]","topic":"calendrierEloise","name":"Agenda - Prise Eloise","onPayload":"true","onPayloadType":"bool","offPayload":"false","offPayloadType":"bool","onlyWhenDark":false,"scheduleRndMax":"2","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":180,"y":320,"wires":[["a0be2234d733f8ab"]]},{"id":"4e9b6526a373a54c","type":"debug","z":"b7a3c194e014f96d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1270,"y":460,"wires":[]},{"id":"f0ff3183e3e0f0af","type":"server-state-changed","z":"b7a3c194e014f96d","name":"isHomecinéOn ?","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.denon_avr_x1200w","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":660,"wires":[["c89bcb70116c01a5"]]},{"id":"c89bcb70116c01a5","type":"function","z":"b7a3c194e014f96d","name":"","func":"if (msg.payload === 'on')\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n   \n};\nif (msg.payload === 'off') msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":660,"wires":[["9a78821afcddf5aa"]]},{"id":"9a78821afcddf5aa","type":"api-call-service","z":"b7a3c194e014f96d","name":"Prise TV Salon","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"","areaId":[],"deviceId":[],"entityId":["switch.prise_tv_salon"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":620,"y":660,"wires":[[]]},{"id":"38d11e0a24aa562b","type":"comment","z":"b7a3c194e014f96d","name":"TV Salon","info":"","x":60,"y":560,"wires":[]},{"id":"a0be2234d733f8ab","type":"function","z":"b7a3c194e014f96d","name":"","func":"if (msg.payload === 'on')\nmsg.payload = \n{\n    \"service\":\"turn_on\"\n   \n};\nif (msg.payload === 'off') msg.payload = {\"service\":\"turn_off\"}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":320,"wires":[["314d2a20bfedfa2c"]]},{"id":"314d2a20bfedfa2c","type":"api-call-service","z":"b7a3c194e014f96d","name":"Bureau Éloïse","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"","areaId":[],"deviceId":[],"entityId":["switch.prise_bureau_eloise"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":320,"wires":[[]]},{"id":"586ad27957aefd26","type":"debug","z":"bd8aec8f1871271e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":200,"wires":[]},{"id":"98880199f1176c79","type":"function","z":"bd8aec8f1871271e","name":"Une personne sonne","func":"msg.payload =\n\n\"Une personne sonne au portail!!\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":360,"wires":[["477d585d0c37ac25"]]},{"id":"477d585d0c37ac25","type":"link out","z":"bd8aec8f1871271e","name":"VersEchos","mode":"link","links":["34dd5813f28f2a42","a7ddbf0dfd2c325b","ced87f2e5d5c0601"],"x":970,"y":360,"wires":[],"l":true},{"id":"ce1ba4885e7c9404","type":"api-call-service","z":"bd8aec8f1871271e","name":"Faire sonner le carillon","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.carillon_switch"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":700,"y":420,"wires":[["b198bad7c7f84a01"]]},{"id":"91019890881dd890","type":"link out","z":"bd8aec8f1871271e","name":"VersTelegramPhotoDoorbird","mode":"link","links":["231b1b91f3733db4"],"x":720,"y":280,"wires":[],"l":true},{"id":"b198bad7c7f84a01","type":"api-call-service","z":"bd8aec8f1871271e","name":"Portier App en premier plan","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"rest_command","service":"launch_portier_app_on_android_tab","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1000,"y":420,"wires":[["f402f4e819ec9aa3","0f42e9ba31ea7116"]]},{"id":"f402f4e819ec9aa3","type":"debug","z":"bd8aec8f1871271e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1230,"y":300,"wires":[]},{"id":"2962a429d609e2d8","type":"api-call-service","z":"bd8aec8f1871271e","name":"HA en premier plan","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":["button.lenovo_tab_m10_fhd_plus_bring_to_foreground"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1530,"y":420,"wires":[[]]},{"id":"0f42e9ba31ea7116","type":"delay","z":"bd8aec8f1871271e","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1260,"y":420,"wires":[["2962a429d609e2d8"]]},{"id":"a1fba6b629d0d7e8","type":"cron","z":"bd8aec8f1871271e","name":"Every 10 minutes","crontab":"*/10 * * * *","x":1100,"y":580,"wires":[["2962a429d609e2d8"]]},{"id":"d6369fc9dde8fd65","type":"inject","z":"bd8aec8f1871271e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1130,"y":720,"wires":[["2962a429d609e2d8"]]},{"id":"d24025ec168c1be2","type":"link in","z":"bd8aec8f1871271e","name":"PortierAppVersHAFrontend","links":["559ffc9b1cc28961"],"x":780,"y":580,"wires":[["b198bad7c7f84a01"]],"l":true},{"id":"adcc5097c0af086d","type":"api-call-service","z":"bd8aec8f1871271e","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"rest_command","service":"fully_kiosk_cuisine_cmd","areaId":[],"deviceId":[],"entityId":[],"data":"{\t    \"url\": msg.payload\t}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":810,"y":880,"wires":[["c017d02d25dceb75"]]},{"id":"2d2d659fa9c74160","type":"inject","z":"bd8aec8f1871271e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":320,"y":800,"wires":[["bebdf821bfc5820e"]]},{"id":"c017d02d25dceb75","type":"debug","z":"bd8aec8f1871271e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":880,"wires":[]},{"id":"bebdf821bfc5820e","type":"function","z":"bd8aec8f1871271e","name":"Une personne sonne","func":"msg.payload =\n\n\"cmd=textToSpeech&text=Une personne sonne au portail!!\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480,"y":880,"wires":[["adcc5097c0af086d"]]},{"id":"4878751a8d1b0500","type":"function","z":"bd8aec8f1871271e","name":"Une personne sonne","func":"msg.payload =\n\n\"cmd=textToSpeech&text=Une personne sonne au portail!!\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":320,"wires":[["ecd1b8cfa47eced4"]]},{"id":"ecd1b8cfa47eced4","type":"link out","z":"bd8aec8f1871271e","name":"Vers Tablette","mode":"link","links":["685bdcecb00a3c9e"],"x":970,"y":320,"wires":[],"l":true},{"id":"1bfd41d483047af4","type":"server-state-changed","z":"bd8aec8f1871271e","name":"","server":"43d85569dace75e0","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.portier_une_personne_sonne","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":300,"y":360,"wires":[["ce1ba4885e7c9404","98880199f1176c79","91019890881dd890"],[]]},{"id":"4c033ca44b2ec252","type":"inject","z":"cb6f6212810a81c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":320,"y":160,"wires":[["eb39a210cd5f070a"]]},{"id":"35aae902b7f19c7c","type":"debug","z":"cb6f6212810a81c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1350,"y":160,"wires":[]},{"id":"eb39a210cd5f070a","type":"api-render-template","z":"cb6f6212810a81c8","name":"","server":"43d85569dace75e0","version":0,"template":"{{ now().timestamp() | timestamp_custom('%Y-%m-%d %H:%M:%S', true)}}","resultsLocation":"payloadStart","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":620,"y":140,"wires":[["04bb1371a609e624"]]},{"id":"2d1b490a8f152cba","type":"api-render-template","z":"cb6f6212810a81c8","name":"","server":"43d85569dace75e0","version":0,"template":"{{ (now().timestamp() + 300) | timestamp_custom('%Y-%m-%d %H:%M:%S","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":640,"y":240,"wires":[[]]},{"id":"04bb1371a609e624","type":"function","z":"cb6f6212810a81c8","name":"","func":"msg.payload = \n{\n    \"service\":\"add_event\",\n    data:\n    {  \"calendar_id\": \"90kmsfbmhueurlhf74e6od3rc8@group.calendar.google.com\",\n    \"summary\": \"Bowling\",\n    \"description\": \"Birthday bowling\",\n    \"start_date_time\": msg.payloadStart,\n    \"end_date_time\": msg.payloadStart,\n}\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":140,"wires":[["5fe2cf5b9a298583"]]},{"id":"5fe2cf5b9a298583","type":"api-call-service","z":"cb6f6212810a81c8","name":"","server":"43d85569dace75e0","version":5,"debugenabled":false,"domain":"google","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":140,"wires":[["35aae902b7f19c7c"]]}]